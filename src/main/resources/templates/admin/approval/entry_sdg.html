<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <head th:include="admin/layout :: header">
    <style>
    .pointer {cursor: pointer;}
    </style>
</head>
<title >Data Approval / SDG Indicators Monitoring</title>
<body>
    <div th:include="admin/layout :: menu"></div>

<!--  Content  -->
    <div id="content">
        <div id="content-header">
            <div id="breadcrumb" class="lang_eng" style="display: none"> <a href="#" title="Go to Home" class="tip-bottom"><i class="icon-home"></i>Data Approval / SDG Indicators Monitoring</a></div>
            <div id="breadcrumb" class="lang_indo"> <a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>Persetujuan Data / Monitor Indikator SDG</a></div>
        </div>
        <div class="container-fluid" id="teruskan">
            <div class="row-fluid">
                <div class="widget-box">
                    <div class="widget-title lang_eng" id="judul-eng" style="display: none">
                        <span class="icon"><i class="icon-tasks"></i></span>
                        <h5>Approval Table</h5>
                    </div>
                    <div class="widget-title lang_indo" id="judul-indo">
                        <span class="icon"><i class="icon-tasks"></i></span>
                        <h5>Tabel Approval</h5>
                    </div>
                    <div class="widget-content">
                        <div class="pull-left" style="width:100%">
                            <select th:field="*{listprov}" class="span3" id="id_prov" name="id_prov">
                                <option value="0" >-- Pilih --</option>
                                <option th:each="list : ${listprov}" th:value="${list.id_prov}" th:text="${list.acronym}"></option>
                            </select>
                            <select id="periode" name="periode" class="form-control">
                                <option value="0" >-- Pilih --</option>
                            </select>
                            <select id="period" name="period" class="form-control">
                                <option value="0" ><span class=""> -- Pilih -- </span> </option>
                            </select>
                            <div class="input-append">
                                <button class="btn btn-success " id="show_report">
                                    <span class="lang_eng" style="display:none">Show Report</span>
                                    <span class="lang_indo">Tampil Laporan</span>
                                </button>
                                <button class="btn btn-warning " id="unshow_report" style="display: none">
                                    <span class="lang_eng" style="display:none">UnShow Report</span>
                                    <span class="lang_indo">Batal Tampil Laporan</span>
                                </button>
                            </div>
                        </div>
                       <div class="row-fluid">
                            <div class="span12">
                            	<div class="table-responsive">
	                                <table class="table table-bordered table-striped" id="tabel-role">
	                                    <thead>
	                                        <tr>
	                                            <th style="text-align:center;font-size:80%;" width="20%">
	                                            	<span class="lang_eng" style="display:none">No</span>
													<span class="lang_indo">No</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;" width="45%">
	                                            	<span class="lang_eng" style="display:none">Name</span>
	                                            	<span class="lang_indo">Nama</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;" width="15%">
                                                    <span class="lang_eng" style="display:none">Status</span>
                                                    <span class="lang_indo">Status</span>
                                                </th>
	                                            <th style="text-align:center;font-size:80%;" width="20%">
	                                            	<span class="lang_eng" style="display:none">Action</span>
	                                            	<span class="lang_indo">Aksi</span>
	                                            </th>
	                                        </tr>
	                                    </thead>
	                                    <tbody id="tbody-role">
	                                    </tbody>
	                                </table>
                                </div>
                            </div>
                        </div>
<!--                        <div class="row-fluid">
                            <div class="span6">
                            </div>
                            <div class="span6" align="right">
                                <div class="input-append">
                                    <input placeholder="Search..." class="span10" id="text-cari" type="text"/>
                                    <span class="add-on"><i class="icon-search"></i></span>
                                </div>
                            </div>
                    	</div>-->
                        <div class="row-fluid tabel-entri-sdg" style="margin-top:40px">
                            <div class="span12">
                            	<div><strong class="nama-mentri"></strong></div>
                            	<form id="form-detail">
                                <table  id="tabel-entri-sdg" class="table table-striped table-bordered">
                                    <thead >
                                    </thead>
                                    <tbody id="tbody_entri-sdg">
                                    </tbody>
                                </table>
                                </form>
                                <div class="btn-toolbar tombol-new" style="float:right;display: none">
	                                <button class="btn btn-warning btn-small ubah-new">
	                                    <span class="lang_eng" style="display: none">Edit</span>
	                                    <span class="lang_indo">Ubah</span>
	                                </button>
	                                <button class="btn btn-primary btn-small simpan-new">
	                                	<span class="lang_eng" style="display: none">Save</span>
	                                    <span class="lang_indo">Simpan</span>
									</button>
	                            </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="myModal"data-backdrop="static" class="modal hide fade modal-lg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
			    <h3 class="lang_eng" style="display:none">Approval</h3>
			    <h3 class="lang_indo">Persetujuan</h3>
		  	</div>
			<div class="modal-body">
				<form>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Choose Approval</label>
				    <label class="lang_indo control-label">Pilih Persetujuan</label>
				    <div class="controls">
				    	<label style="display:inline-block;white-space:nowrap;">
			            	<input style="vertical-align:middle" class="approval" name="approval" type="radio" value="5">
			                <span style="vertical-align:middle">No Action</span>
			            </label>
				    	<span class="help-block" id="error_approval"></span>
				    </div>
				  </div>
				  <div class="control-group">
				  	<input id="id_approval" name="id_approval" type="hidden" value=""/>
				  	<label style="display:inline-block;white-space:nowrap;">
		            	<input style="vertical-align:middle" class="approval" name="approval" type="radio" value="2">
		                <span style="vertical-align:middle">Approve</span>
		            </label>	
				  </div>
				  <div class="control-group">
				  	<label style="display:inline-block;white-space:nowrap;">
		            	<input style="vertical-align:middle" class="approval" name="approval" type="radio" value="3">
		                <span style="vertical-align:middle">Reject</span>
		            </label>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Description</label>
				    <label class="lang_indo control-label">Deskripsi</label>
				    <div class="controls">
            			<input id="modal_id_role" name="modal_id_role" type="hidden"/>
            			<input id="modal_nama" name="modal_nama" type="hidden"/>
				    	<textarea readonly="true" id="description" name="description" class="input-xlarge input-block-level" rows="5"></textarea>
				    	<span class="help-block" id="error_description"></span>
				    </div>
				  </div>
				</form>
			</div>
			<div class="modal-footer">
		    	<button class="btn" data-dismiss="modal" aria-hidden="true">
		    		<span class="lang_eng" style="display:none">Close</span>
		    		<span class="lang_indo">Tutup</span>
		    	</button>
		    	<button class="btn btn-primary" id="simpan-approval">
		    		<span class="lang_eng" style="display:none">Submit</span>
		    		<span class="lang_indo">Simpan</span>
		    	</button>
		  	</div>
		</div>
    </div>
    <div th:include="admin/layout :: footer"></div>
</body>

<script th:inline="javascript" >
    // <![CDATA[
            //$(document).ready(function (e) {
            var id_role     = [[${id_role}]];
            var id_prov     = [[${id_prov}]];
            var privilege   = [[${privilege}]];
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");
            cek_show_report();
            if(id_role == '1'){
                
            }else{
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-option-role-all-profil/'+id_prov,
                    success: function (result) {
                        $("#idrole").html('<option value="0" >-- Pilih --</option>');
                        var array = result.content;
                        if (array != '') {
                            for (i in array) {
                                $("#idrole").append('<option value="'+array[i][0]+'" >'+array[i][1]+'</option>');
                            }
                        }
                        if(privilege == 'ADMIN'){
                            $("#idrole").val('0').trigger("change").attr('disabled',false);
                        }else{
                            $("#idrole").val(id_role).trigger("change").attr('disabled',true);
                        }
                    }
                });
                
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-option-monper/'+id_prov,
                    success: function (result1) {
                        $("#periode").html('<option value="0" >-- Pilih --</option>');
                        var array1 = result1.content;
                        if (array1 != '') {
                            for (i in array1) {
                                var selisih     = (array1[i][2] - array1[i][1]);
//                                console.log(array1[i][2]);
                                var x;
                                for(x=0; x<=selisih; x++){
//                                    console.log((array1[i][1]+x));
                                    $("#periode").append('<option value="'+array1[i][0]+'###'+(array1[i][1]+x)+'" >'+(array1[i][1]+x)+'</option>');
                                }
                                
                            }
                        }
                        
                    }
                });
                
                $("#id_prov").val(id_prov).trigger("change").attr('disabled',true);
            }
            
            
            $("#id_prov").on('change', function(e){
                var id_prov = this.value ;
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-option-role-all-profil/'+id_prov,
                    success: function (result) {
                        $("#idrole").html('<option value="0" >-- Pilih --</option>');
                        var array = result.content;
                        if (array != '') {
                            for (i in array) {
                                $("#idrole").append('<option value="'+array[i][0]+'" >'+array[i][1]+'</option>');
                            }
                        }
                    }
                });
                
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-option-monper/'+id_prov,
                    success: function (result1) {
                        $("#periode").html('<option value="0" >-- Pilih --</option>');
                        var array1 = result1.content;
                        if (array1 != '') {
                            for (i in array1) {
                                var selisih     = (array1[i][2] - array1[i][1]);
//                                console.log(array1[i][2]);
                                var x;
                                for(x=0; x<=selisih; x++){
//                                    console.log((array1[i][1]+x));
                                    $("#periode").append('<option value="'+array1[i][0]+'###'+(array1[i][1]+x)+'" >'+(array1[i][1]+x)+'</option>');
                                }
                                
                            }
                        }
                    }
                });
                $(".tabel-entri-sdg").hide();
                cek_show_report();
            });
            
            $('#teruskan').on('click', '#apply_btn', function(e){
                alert('button is not a function');
            });
            
            //Bahasa
            var title = "Simpan Nilai Baru";
            var titleDel = "Anda Yakin";
	        var messDel = "Menghapus Data?";
	        var buttDel = 'Ya, Hapus data ini!';
	        var titleApp = "Anda Yakin";
	        var messApp = "Apply Data ini?";
	        var buttApp = 'Ya, Apply data ini!';
	        var titleOk	= "Hapus";
	        var messOk = "Data berhasil dihapus";
	        var messNOk = "Data tidak dapat dihapus";
	        var required = "Harus diisi";
	        var messSaveOk = "Data berhasil disimpan";
	        var messSaveNOk = "Data tidak dapat disimpan";
	        var titleMod = "Maaf";
	        var messMod = "Semua pilihan harus dipilih";
	        var buttDel1 = 'Ya';
	        function bhs(cek){
				if(cek){
					$(".lang_indo").show();
	        		$(".lang_eng").hide();
	        		title = "Simpan Nilai Baru";
	        		titleDel = "Anda Yakin";
	        		messDel = "Menghapus Data?";
	        		buttDel = 'Ya, Hapus data ini!';
	        		titleOk	= "Hapus";
	    	        messOk = "Data berhasil dihapus";
	    	        messNOk = "Data tidak dapat dihapus";
	    	        required = "Harus diisi";
	    	        titleApp = "Anda Yakin";
	    	        messApp = "Apply Data ini?";
	    	        buttApp = 'Ya, Apply data ini!';
	    	        messSaveOk = "Data berhasil disimpan";
	    	        messSaveNOk = "Data tidak dapat disimpan";
	    	        titleMod = "Maaf";
	    	        messMod = "Semua pilihan harus dipilih";
	    	        buttDel1 = 'Ya';
	        	}else{	    	        
	    	        $(".lang_indo").hide();
	        		$(".lang_eng").show();
	        		title = "Save new value";
	        		titleDel = "Are you sure";
	        		messDel = "Delete this data?";
	        		buttDel = 'Yes, Delete this data!';
	        		titleOk	= "Delete";
	    	        messOk = "Delete successful";
	    	        messNOk = "Can't delete data";
	    	        required = "Required";
	    	        titleApp = "Are you sure";
	    	        messApp = "Apply this data?";
	    	        buttApp = 'Ya, Apply this data!';
	    	        messSaveOk = "Save successful";
	    	        messSaveNOk = "Can't save data";
	    	        titleMod = "Sorry";
	    	        messMod = "All dropdownlists must be selected";
	    	        buttDel1 = 'Yes';
	        	}
	        }
	        if(lang){
	        	bhs(lang=="0");
	        }else{
	        	bhs($('#fs').is(':checked'));
	        }
	        
	        $('#fs').on('change', function(e){
                    grid();
	        	bhs($(this).is(':checked'));
	        });

            var v_idprov    = $("#id_prov").val();
            var v_idrole    = $("#idrole").val();
            var v_dataid    = $("#periode").val();
            var v_data_id   = v_dataid.split("###");;
            var id_monper   = v_data_id[0];
            var tahun       = v_data_id[1];
            var v_period    = $("#period").val().split("###")[2];
            
            var table = $('#tabel-role').DataTable({
				responsive: true,
				sDom: 'lrtip',
				"bLengthChange": false,
				"cache": false,
				"autoWidth": true,
				"responsive":true,
				"ajax": {
					"url": urls+'list-role-approval/'+0+'/'+0+'/entry_sdg/0',
					dataSrc: 'content',
				},
				"searching": true,
				"columns": [
					{"data": function (row, data, index, display) {
							return "<div style='font-size:90%;'>"+(display.row+1)+"</div>";
						}},
					{"data": function (row, data, index, display) {
							var statusApp = 0;
							if(row[3]==2){
								statusApp = 1;
							}else if(row[3]==3){
								statusApp = 1;
							}else if(row[3]==4){
								statusApp = 1;
							}
							return "<div style='font-size:90%;'><a class='id_role' data-id='"+(row[1]?row[1]:'unassign')+"' data-statusApp='"+statusApp+"' data-period='"+row[6]+"' href='#'>"+(row[2]?row[2]:'Unassign')+"</a></div>";
						}},
						{"data": function (row, data, index, display) {
	                        if(row[3] == '1'){
	                            return "<span style='font-size:90%; background: #f5ff6e; text-align: center;'>Wait Approval</span>";
	                        }else if(row[3] == '2'){
	                            return "<span style='font-size:90%; background: #6eeaff; text-align: center;'>Approved</span>";
	                        }else if(row[3] == '3'){
	                            return "<span style='font-size:90%; background: #ffa6a6; text-align: center;'>Rejected</span>";
	                        }else if(row[3] == '4'){
	                            return "<span style='font-size:90%; background: #b5ffb5; text-align: center;'>Done</span>";
	                        }else{
	                        	return "<span style='font-size:90%; background: #f5ff6e; text-align: center;'>Not Approved</span>";
	                        }
	                        
	                    }},
					{"data": function (row, data, index, display) {
							var warna = "btn-primary";
							var text = "Approve";
							var hide = "";
							var kelas = "approve"
							if(row[3]==2){
								if($("#fs").is(':checked')){
									text = "Batal Setujui";
    							}else{
    								text = "Unapprove";
    							}
								warna = "btn-success";
								kelas = "unapprove";
							}else if(row[3]==3){
								if($("#fs").is(':checked')){
									text = "Batal Tolak";
    							}else{
    								text = "unreject";
    							}
								warna = "btn-danger";
								kelas = "unapprove";
								$.ajax({
	                                type: "GET",
	                                async:false,
	                                url: urls+'list-get-cek-show-report/'+$("#periode").val().split("###")[0]+'/'+$("#periode").val().split("###")[1]+'/1/entry_sdg/'+$("#period").val().split("###")[2],
	                                success: function (result1) {
	                                    var sts = result1.content;
	                                    if(sts == '0'){
	                                    	hide="";
	                                    }else{
	                                    	hide="display:none;";
	                                    }
	                                }
	                            });
							}else if(row[3]==4){
								hide = 'display:none';
								kelas = "approve";
							}else if(row[3]==5){
								if($("#fs").is(':checked')){
									text = "Approve";
    							}else{
    								text = "Approve";
    							}
								warna = "btn-default";
								kelas = "approve";
							}
							
							return "<div style='text-align:center;"+hide+"'>"+
							'<button data-id_role="'+row[1]+'" data-nama="'+(row[2]?row[2]:'Unassign')+'" data-id="'+row[0]+'" data-approval="'+row[3]+'" data-description="'+row[5]+'" type="button" title="approve" class="btn '+warna+' '+kelas+' ">'+text+'</div>';
						}},
				],
				"columnDefs": [
				],
				select: true
			});	
            
            $("#periode").on('change', function(e){
                var data_id     = this.value.split("###");
                var id_monper   = data_id[0];
                var tahun       = data_id[1];
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-sts-monper-sdg/'+id_monper,
                    success: function (result1) {
                        var sts = result1.content;
                        if(sts == 'yearly'){
                            var s_html = '<option value="0" >-- Pilih --</option><option value="'+id_monper+'###'+tahun+'###1" selected >End of fiscal year</option>';
                        }else if(sts == 'semesterly'){
                            var s_html = '<option value="0" >-- Pilih --</option><option value="'+id_monper+'###'+tahun+'###1" >Semester 1</option><option value="'+id_monper+'###'+tahun+'###2" >Semester 2</option>';
                        }else if(sts == 'quarterly'){
                            var s_html = '<option value="0" >-- Pilih --</option><option value="'+id_monper+'###'+tahun+'###1" >Quarter 1</option><option value="'+id_monper+'###'+tahun+'###2" >Quarter 2<option value="'+id_monper+'###'+tahun+'###3" >Quarter 3</option><option value="'+id_monper+'###'+tahun+'###4" >Quarter 4</option>';
                        }else{}
                        $("#period").html(s_html);
                        if(sts == 'yearly'){
                        	$("#period").trigger('change');
                        }
                    }
                });
                $(".tabel-entri-sdg").hide();
                cek_show_report();
            });
            
            $("#period").on('change', function(e){
                var data_id     = this.value.split("###");;
                var id_monper   = data_id[0];
                var tahun       = data_id[1];
                var period       = data_id[2];
                table.ajax.url(urls+'list-role-approval/'+id_monper+'/'+tahun+'/entry_sdg/'+period).load();
                $(".tabel-entri-sdg").hide();
                cek_show_report();
            });
            
            function newValue(id_role, period, status, nama){
                $('.nama-mentri').text(nama);
                grid(id_role,period);
                if(status=="1"){
                	$('.tombol-new').hide();
                }else{
                	$('.tombol-new').show();
                }
                $(".tabel-entri-sdg").show();
            }
            
            var new_id_role;
            var new_period;
            var new_status;
            var new_nama;
            
            $('#tbody-role').on('click', '.approve', function(){
            	var id = $(this).data("id");
            	var approval = $(this).data("approval");
            	var description = $(this).data("description");
            	$("#id_approval").val(id);
            	$('.approval[value="'+approval+'"]').prop("checked", true).trigger("click");
            	$("#description").val("");
            	$("#description").text((description?description:''));
            	$("#modal_id_role").val($(this).data("id_role"));
            	$("#modal_nama").val($(this).data("nama"));
            	$("#myModal").modal('show');
            }).on('click', ".id_role", function(e){
                var id_role = $(this).data("id");
                var period = $(this).data("period");
                var status = $(this).data("statusapp");
                var nama = $(this).text();
                new_id_role = id_role;
                new_period = period;
                new_status = status;
                new_nama = nama;
                newValue(id_role, period, status, nama);
            }).on('click', '.unapprove', function(){
            	var id = $(this).data("id");
            	var id_role = $(this).data("id_role");
                var nama = $(this).data("nama");
            	swal({
                    title: titleDel,
                    text: "",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: buttDel1
                }).then(function () {
                	var data = JSON.stringify({
    					'id':id,
    					'approval':'1',
    					'description':""
    					});
                	$.ajax({
    					type: "POST",
                        url: urls+'update-approval',
                        beforeSend : function(xhr){
                        	xhr.setRequestHeader(header,token);
                        },
                        headers:{'Accept':'application/json','Content-Type':'application/json'},
    					data: data,
                        success: function (result) {
                        	var data_id     = $("#period").val().split("###");;
                            var id_monper   = data_id[0];
                            var tahun       = data_id[1];
                            var period       = data_id[2];
                            table.ajax.url(urls+'list-role-approval/'+id_monper+'/'+tahun+'/entry_sdg/'+period).load();
                            if($(".tabel-entri-sdg").is(":visible")){
	                        	var period = period;
	                        	var statusApp = 0;
	                            newValue(id_role, period, statusApp, nama);
	                    	}
                        },
                    });
                }, function (dismiss) {
                    if (dismiss === 'cancel') {
                    }
                });
            });
            
            $('#myModal').on('hidden.bs.modal',function(){
            	$("#id_approval").val("");
            	$('.approval').prop("checked", false);
            	$("#description").text("").attr('readonly', true);
			});
            
            $('.approval').on('click', function(){
            	var nilai = $(this).val();
            	if(nilai==3){
            		$('#description').removeAttr("readonly");
            	}else{
            		$('#description').val("").attr("readonly", true);
            	}
            });
            
            $("#simpan-approval").on('click', function(){
            	var id = $('#id_approval').val();
            	var approval = $('input[name="approval"]:checked').val();
            	var description = $("#description").val();
            	if(approval!=0){
            		var data = JSON.stringify({
						'id':id,
						'approval':approval,
						'description':description
						});
            		$.ajax({
						type: "POST",
	                    url: urls+'update-approval',
	                    beforeSend : function(xhr){
	                    	xhr.setRequestHeader(header,token);
	                    },
	                    headers:{'Accept':'application/json','Content-Type':'application/json'},
						data: data,
	                    success: function (result) {
	                    	var data_id     = $("#period").val().split("###");;
	                        var id_monper   = data_id[0];
	                        var tahun       = data_id[1];
	                        var period       = data_id[2];
	                        table.ajax.url(urls+'list-role-approval/'+id_monper+'/'+tahun+'/entry_sdg/'+period).load();
	                        if($(".tabel-entri-sdg").is(":visible")){
	                        	var id_role = $("#modal_id_role").val();
	                            var period = period;
	                            var statusApp = 0;
								if(approval==2){
									statusApp = 1;
								}else if(approval==3){
									statusApp = 1;
								}else if(approval==4){
									statusApp = 1;
								}
	                            var nama = $("#modal_nama").val();
	                            newValue(id_role, period, statusApp, nama);
	                    	}
	                    },
	                });
            	}
            	$('#myModal').modal('hide');
            });
            
            function cek_show_report(){
                var v_dataid    = $("#periode").val();
                var v_period    = $("#period").val().split("###")[2];
                var v_data_id   = v_dataid.split("###");
                var id_monper   = v_data_id[0];
                var tahun       = v_data_id[1];
                var v_type      = 'entry_sdg';	
                var sts         = '1';	
                $.ajax({
                    type: "GET",
                    url: urls+'list-get-cek-show-report/'+id_monper+'/'+tahun+'/'+sts+'/'+v_type+'/'+v_period,
                    success: function (result1) {
                        var sts = result1.content;
                        console.log(sts+" "+v_period);
                        if(sts == '0'){
                            $("#show_report").show();
                            $("#unshow_report").hide();
                        }else{
                            $("#show_report").hide();
                            $("#unshow_report").show();
                        }
                    }
                });
            }
            
            $('#show_report').on('click', function(){
            	var data_id     = $("#period").val().split("###");
                var id_monper   = data_id[0];
                var tahun       = data_id[1];
                var period       = data_id[2];
                
                if(id_monper && tahun && period){
            	swal({
                    title: titleDel,
                    text: "",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: buttDel1
                }).then(function () {
                	var data = JSON.stringify({
                		'id_monper':id_monper,
						'tahun':tahun,
						'period':period
						});
		        	$.ajax({
		                type: "POST",
		                url: urls+'show-report-sdg',
		                beforeSend : function(xhr){
		                    xhr.setRequestHeader(header,token);
		                },
		                headers:{'Accept':'application/json','Content-Type':'application/json'},
		                data: data,
		                success: function (result) {
		                	table.ajax.url(urls+'list-role-approval/'+id_monper+'/'+tahun+'/entry_sdg/'+period).load();
                            cek_show_report();
                            if($(".tabel-entri-sdg").is(":visible")){
	                            newValue(new_id_role, new_period, new_status, new_nama);
	                    	}
		                },
		            });
                }, function (dismiss) {
                    if (dismiss === 'cancel') {
                    }
                });
                }else{
                	swal(titleMod,messMod,'error');
                }
            });
            
            $('#unshow_report').on('click', function(){
              var v_dataid    = $("#periode").val();
              var v_period    = $("#period").val().split("###")[2];
              var v_data_id   = v_dataid.split("###");
              var id_monper   = v_data_id[0];
              var tahun       = v_data_id[1];
              var v_idprov    = $("#id_prov").val();
              var v_type      = 'entry_sdg';	
              swal({
                  title: titleDel,
                  text: "",
                  type: 'warning',
                  showCancelButton: true,
                  confirmButtonColor: '#3085d6',
                  cancelButtonColor: '#d33',
                  confirmButtonText: buttDel1
              }).then(function () {
                  var periode             = v_period;
                  var id_monper1           = id_monper;
                  var year                = tahun;
                  var approval            = "4";
                  var type                = v_type;

                  var data1    = JSON.stringify({
                                  'id': "1",
                                  'id_form_type': "0",
                                  'id_role': "1",
                                  'id_monper': id_monper1,
                                  'year': year,
                                  'approval': approval,
                                  'approval_date': null,
                                  'type': type,
                                  'periode': periode,
                                  'description': '-'
                              });
                  $.ajax({
                      type: "POST",
                      url: urls+'done-approve-gov_prog1_unshow',
                      beforeSend : function(xhr){
                          xhr.setRequestHeader(header,token);
                      },
                      headers:{'Accept':'application/json','Content-Type':'application/json'},
                      data: data1,
                      success: function (result) {
                    	  table.ajax.url(urls+'list-role-approval/'+id_monper+'/'+tahun+'/entry_sdg/'+v_period).load();
                          cek_show_report();
                          if($(".tabel-entri-sdg").is(":visible")){
	                            newValue(new_id_role, new_period, new_status, new_nama);
	                    	}
                      },
                  });
              }, function (dismiss) {
                  if (dismiss === 'cancel') {
                  }
              });
          });
            
            function grid(idrole,period)
            {
                var v_idprov    = $("#id_prov").val();
                var v_idrole    = idrole;
                var v_dataid    = $("#periode").val();
                var v_data_id   = v_dataid.split("###");;
                var id_monper   = v_data_id[0];
                var tahun       = v_data_id[1];
                var header1="";
                var header2="";
                var header3="";
                var header4="";
                var header5="";
                var header6="";
                if($('#fs').is(':checked')){
                	header1 = "Kode Indikator";
                	header2 = "Nama Indikator";
                	header3 = "Satuan";
                	header4 = "Target SDG";
                	header5 = "Realisasi SDG "+period;
                	header6 = "Nilai Baru";
                }else{
                	header1 = "Indicator Code";
                	header2 = "Indicator Name";
                	header3 = "Unit";
                	header4 = "SDGs Target";
                	header5 = 'SDGs Realization '+period;
                	header6 = "New Value";
                }
                $('#tabel-entri-sdg').DataTable({
                    responsive: true,
                    sDom: 'lrtip',
                    "bLengthChange": false,
                    "cache": false,
                    "autoWidth": true,
                    "responsive":true,
                    "bDestroy": true,
                    "ordering": false,
                    "paging": false,
                    "ajax": {
                        "url": urls+'list-entry-sdg/'+v_idprov+'/'+v_idrole+'/'+id_monper+'/'+tahun,
                        dataSrc: 'content',
                    },
                    "searching": true,
                    "columns": [
                        {"title": header1,"data": function (row, data, index, display) {
                        	var disaggre = "";
                        	console.log(row);
                        	if(row[25]){
                        		return "<div style='font-size:90%;'>"+row[15]+"."+row[17]+"."+row[19]+"."+row[25]+"</div>"
                        	}else{
                        		return "<div style='font-size:90%;'>"+row[15]+"</div><span style='font-size:90%;'>"+row[15]+"."+row[17]+"</span><div style='font-size:90%;'>"+row[15]+"."+row[17]+"."+row[19]+"</div>";
                        	}
                        }},
                        {"title": header2,"data": function (row, data, index, display) {
                        	if($('#fs').is(':checked')){
                            	var disaggre = "";
                           		if(row[25]){
                           			return "<div style='font-size:90%; padding-left: 35px'>"+row[26]+" "+row[28]+"</div>";
                               	}else{
                               		return "<div style='font-size:90%;'>"+row[3]+"</div><span style='font-size:90%; padding-left: 15px'>"+row[4]+"</span><div style='font-size:90%; padding-left: 30px'>"+row[5]+"</div>";
                               	}
                                
                            }else{
                            	var disaggre = "";
                            	if(row[25]){
                            		return "<div style='font-size:90%; padding-left: 35px'>"+row[27]+" "+row[29]+"</div>";
                               	}else{
                               		return "<div style='font-size:90%;'>"+row[16]+"</div><span style='font-size:90%; padding-left: 15px'>"+row[18]+"</span><div style='font-size:90%; padding-left: 30px'>"+row[20]+"</div>";
                               	}
                                
                            }
                        }},
                        {"title": header3,"data": function (row, data, index, display) {
                            return "<div style='font-size:90%;'>"+row[6]+"</div>";
                        }},
                        {"title": header4,"data": function (row, data, index, display) {
                            if(row[8] == null || row[8] == ""){
                                return "<div style='font-size:90%;'> 0 </div>";
                            }else{
                                return "<div style='font-size:90%;'>"+row[8]+"</div>";
                            }

                        }},
                        {"title": header5,"data": function (row, data, index, display) {
                        	var target  = row[8];
                            var IncDec  = row[7];
							var nilai="";
							if(period==1){
								if(row[30]){
									nilai = row[33];
								}else{
									nilai = row[9];
								}
							}else if(period==2){
								if(row[30]){
									nilai = row[34];
								}else{
									nilai = row[10];
								}
							}else if(period==3){
								if(row[30]){
									nilai = row[35];
								}else{
									nilai = row[11];
								}
							}else if(period==4){
								if(row[30]){
									nilai = row[36];
								}else{
									nilai = row[12];
								}
							}
							if(IncDec == 'Increment'){
                                if(nilai >= target){
                                    var color_sts = 'btn btn-success';
                                }else{
                                    var color_sts = 'btn btn-danger';
                                }
                            }else{
                                if(nilai <= target){
                                    var color_sts = 'btn btn-success';
                                }else{
                                    var color_sts = 'btn btn-danger';
                                }
                            }
							
                            return (nilai!=null && nilai!='' || nilai==0)?'<button type="button" data-id="'+row[2]+'###'+row[9]+'###'+row[10]+'###'+row[11]+'###'+row[12]+'###1'+'###'+row[14]+'" class="'+color_sts+'">'+nilai+"</button>":"";
                        }},
                        {"title": header6,"data": function (row, data, index, display) {
                        	var nilai="";
							if(period==1){
								if(row[30]){
									nilai = row[37];
								}else{
									nilai = row[21];
								}
							}else if(period==2){
								if(row[30]){
									nilai = row[38];
								}else{
									nilai = row[22];
								}
							}else if(period==3){
								if(row[30]){
									nilai = row[39];
								}else{
									nilai = row[23];
								}
							}else if(period==4){
								if(row[30]){
									nilai = row[40];
								}else{
									nilai = row[24];
								}
							}
							var new_val_id="";
							if(row[25]){
								new_val_id="";
							}else{
								new_val_id=row[14];
							}
                             return "<input type='text' class='new_value' name='sdg[][new_val_nilai]' readonly='true' value='"+(nilai!=null && nilai!="" || nilai==0?nilai:'')+"'/>"+
                             "<input type='hidden' name='sdg[][new_val_id]' value='"+new_val_id+"' />"+
                             "<input type='hidden' name='sdg[][new_val_id_disaggre]' value='"+row[32]+"' />"+
                             "<input type='hidden' name='sdg[][new_val_period]' value='"+period+"' />";
                        }},
                    ],
                    "columnDefs": [
                    ],
                    select: true
                });	
            }
            
			$('.ubah-new').on('click', function(){
				$('#tabel-entri-sdg').find('.new_value').removeAttr('readonly');
			});
			
			$('.simpan-new').on('click', function(){
				var sdg =  $('#form-detail').serializeObject();
				console.log(sdg);
				$.ajax({
	                type    :"POST",
	                url     :urls+'update-new-sdg',
	                headers :{'Accept':'application/json','Content-Type':'application/json'},
	                data    : JSON.stringify({sdg}),
	                beforeSend : function(xhr){
	                	xhr.setRequestHeader(header,token);
	                },
	                success :function(result){
	                	$('#tabel-entri-sdg').find('.new_value').attr('readonly',true);
	                	swal(title, messSaveOk, "success");
	                },
	                error : function(result){
	                	swal(title,messSaveNOk,'error');
	                }              
	             });
			});
			
            $('#text-cari').on( 'keyup', function () {
                var val=$(this).val();
                table.search(val).draw();
            });
            
        //});
    // ]]>
</script>
</html>