<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="admin/layout :: header">
</head>
<title>Define RAN/RAD/Non Government Program</title>
<body>
    <div th:include="admin/layout :: menu"></div>
    <div id="content">
        <div id="content-header">
            <div id="breadcrumb"> <a href="#" title="Go to Home" class="tip-bottom"><i class="icon-home"></i>Define RAN/RAD/Non Government Program</a></div>
        </div>
        <div class="container-fluid">
        	<div class="row-fluid">
        		<form class="form-horizontal">
        			<div class="control-group">
        				<select name="id_prov" id="id_prov">
	        				<option th:each="f:${prov}" th:value="${f.id_prov}" th:text="${f.nm_prov}"></option>
	        			</select>
	        			<select name="id_role" id="id_role">
	        				<option th:each="f:${role}" th:value="${f.id_role}" th:text="${f.nm_role}"></option>
	        			</select>
	        			<span> RAN/RAD : </span>
	        			<select name="id_monper" id="id_monper">
	        				<option th:each="f:${monPer}" th:value="${f.id_monper}" th:text="${f.start_year}+' - '+${f.end_year}"></option>
	        			</select>
        			</div>
        		</form>
        	</div>
			<div class="row-fluid">
				<label class="tip-bottom">Program <i class="icon-angle-right"></i> <span class="lang_eng" style="display:none">Activity</span><span class="lang_indo">Kegiatan</span><i class="icon-angle-right"></i> <span class="lang_eng" style="display:none">Activity Indicator</span><span class="lang_indo">Indikator Kegiatan</span></label>
			</div>
			<div class="row-fluid">
				<div class="widget-box">
					<div class="widget-content">
							Program : 
							<a th:href="@{/admin/ran_rad/non-gov/program}" th:text="${govProg.internal_code+' - '+govProg.nm_program}" class="lang_indo"></a>
						<a th:href="@{/admin/ran_rad/non-gov/program}" th:text="${govProg.internal_code+' - '+govProg.nm_program_eng}" class="lang_eng" style="display:none"></a>
							<br/>
							<span class="lang_eng" style="display:none">Activity : </span><span class="lang_indo">Kegiatan : </span>
							<a th:href="@{'/admin/ran_rad/non-gov/program/'+${govProg.id}+'/activity'}" th:text="${govProg.internal_code+'.'+govActivity.internal_code+' - '+govActivity.nm_activity}" class="lang_indo"></a>
							<a th:href="@{'/admin/ran_rad/non-gov/program/'+${govProg.id}+'/activity'}" th:text="${govProg.internal_code+'.'+govActivity.internal_code+' - '+govActivity.nm_activity_eng}" class="lang_eng" style="display:none"></a>
					</div>
				</div>
			</div>
            <div class="row-fluid">
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-tasks"></i></span>
                        <h5>
                        	<span class="lang_eng" style="display:none">Activity Indicator</span><span class="lang_indo">Indikator Kegiatan</span>
                        </h5>
                    </div>
                    <div class="widget-content">
                    	<div class="row-fluid">
                    		<div class="span6">
                    			<div class="input-append">
								  <input placeholder="Search..." class="span12" id="text-cari" type="text"/>
								  <span class="add-on"><i class="icon-search"></i></span>
								</div>
                    		</div>
                    		<div class="span6" align="right">
                    			<button id="showModal" data-toggle="modal" data-target="#myModal" class="btn btn-primary"><i class="icon-plus"></i>
                    				<span class="lang_eng" style="display:none">Add Activity Indicator</span><span class="lang_indo">Tambah Indikator Kegiatan</span>
                    			</button>
                    		</div>
                    	</div>
                    	<br/>
                        <div class="row-fluid">
                            <div class="span12">
                            	<div class="table-responsive">
	                                <table class="table table-bordered table-striped" id="tabel-indicator">
	                                    <thead>
	                                        <tr>
	                                            <th style="text-align:center;font-size:80%;" width="5%">
	                                            	<span class="lang_eng" style="display:none">SDG E-Monev Code</span>
	                                            	<span class="lang_indo">Kode SDG E-Monev</span>
	                                            </th>
	                                            <!-- <th style="text-align:center;font-size:80%;" width="5%">
	                                            	<span class="lang_eng" style="display:none">Code</span>
	                                            	<span class="lang_indo">Kode</span>
	                                            </th> -->
	                                            <th style="text-align:center;font-size:80%;" width="50%">
	                                            	<span class="lang_eng" style="display:none">Activity Indicator</span>
	                                            	<span class="lang_indo">Indikator Kegiatan</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;" width="5%">
	                                            	<span class="lang_eng" style="display:none">Unit</span>
	                                            	<span class="lang_indo">Satuan</span>
	                                            </th>
	                                            <!-- <th style="text-align:center;font-size:80%;" width="5%" colspan="5">
	                                            	<span class="lang_eng" style="display:none">Target</span>
	                                            	<span class="lang_indo">Target</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;" width="10%" rowspan="2">
	                                            	<span class="lang_eng" style="display:none">Baseline</span>
	                                            	<span class="lang_indo">Baseline</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;" width="10%" rowspan="2">
	                                            	<span class="lang_eng" style="display:none">Agency</span>
	                                            	<span class="lang_indo">Agency</span>
	                                            </th> -->
	                                            <th style="text-align:center;font-size:80%;" width="10%">
	                                            	<span class="lang_eng" style="display:none">Action</span>
	                                            	<span class="lang_indo">Aksi</span>
	                                            </th>
	                                        </tr>
	                                        <!-- <tr>
	                                            <th style="text-align:center;font-size:80%;">
	                                            	1<span class="lang_eng" style="display:none">st</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;">
	                                            	2<span class="lang_eng" style="display:none">nd</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;">
	                                            	3<span class="lang_eng" style="display:none">rd</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;">
	                                            	4<span class="lang_eng" style="display:none">th</span>
	                                            </th>
	                                            <th style="text-align:center;font-size:80%;">
	                                            	5<span class="lang_eng" style="display:none">th</span>
	                                            </th>
	                                        </tr> -->
	                                    </thead>
	                                    <tbody id="tbody-indicator">
	                                    </tbody>
	                                </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="myModal"data-backdrop="static" class="modal hide fade modal-lg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-header">
			    <button type="button" class="close tutup" data-dismiss="modal" aria-hidden="true">Ã—</button>
			    <h3 class="lang_eng" style="display:none">Add Activity Indicators</h3>
			    <h3 class="lang_indo">Tambah Indikator Kegiatan</h3>
		  	</div>
			<div class="modal-body">
				  <div class="control-group">
				    <label>Program</label>
				    <input type="text" style="display:none" readonly="true" th:value="${govProg.nm_program_eng}" class="lang_eng input-xlarge input-block-level" />
				    	<input type="text" readonly="true" th:value="${govProg.nm_program}" class="lang_indo input-xlarge input-block-level" />
				    <input type="hidden" id="id_program" name="id_program" th:value="${govProg.id}"/>
				    <input type="hidden" id="id_activity" name="id_activity" th:value="${govActivity.id}"/>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Activity</label>
				    <label class="lang_indo control-label">Kegiatan</label>
				    <input type="text" readonly="true" th:value="${govActivity.nm_activity}" class="lang_indo input-xlarge input-block-level" />
				    <input type="text" style="display:none" readonly="true" th:value="${govActivity.nm_activity_eng}" class="lang_eng input-xlarge input-block-level" />
				   </div>
				  <div class="control-group" style="display:none;">
				    <label class="lang_eng control-label" style="display:none">Code</label>
				    <label class="lang_indo control-label">Kode</label>
				    <div class="controls">
				    	<input type="text" id="id_nsa_indicator" name="id_nsa_indicator" class="input-medium input-block-level"/>
				    	<input type="hidden" id="id" name="id" class="input-medium input-block-level"/>
				    	<span class="help-block" id="error_id_nsa_indicator"></span>
				    </div>
				  </div>
				  <div id="hide_kode_internal" class="control-group">
				    <label class="lang_eng control-label" style="display:none;text-align:left">SDG E-Monev Code</label>
				    <label class="lang_indo control-label" style="text-align:left">Kode SDG E-Monev</label>
				    <div class="controls">
                        <input type="text" id="internal_code" name="internal_code" class="input-block-level"/>
				    	<span class="help-block" id="error_internal_code"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Activity Indicator (Indonesian)</label>
				    <label class="lang_indo control-label">Indikator Kegiatan (Indonesian)</label>
				    <div class="controls">
				    	<input type="text" id="nm_indicator" name="nm_indicator" class=" input-xlarge input-block-level"/>
				    	<span class="help-block" id="error_nm_indicator"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Activity Indicator (English)</label>
				    <label class="lang_indo control-label">Indikator Kegiatan (English)</label>
				    <div class="controls">
				    	<input type="text" id="nm_indicator_eng" name="nm_indicator_eng" class=" input-xlarge input-block-level"/>
				    	<span class="help-block" id="error_nm_indicator"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Unit</label>
				    <label class="lang_indo control-label">Satuan</label>
				    <div class="controls">
				    	<select id="unit" name="unit" class="input-xlarge input-block-level">
					    	<option th:each="f:${unit}" th:value="${f.id_unit}" th:text="${f.nm_unit}"></option>
					    </select>
					    <span class="help-block" id="error_unit"></span>
				    </div>
				  </div>
				  <div class="table-responsive">
                  	<form id="form-target">
					<table class="table table-bordered">
                        <thead>
							<tr>
                                <th width="50%">
                                	<span class="lang_eng control-label" style="display:none">Year</span>
				    				<span class="lang_indo control-label">Tahun</span>
                                </th>
                                <th width="50%">Target</th>
							</tr>
                        </thead>
                        <tbody id="tbody-target">
                        </tbody>
                    </table>
                    </form>
                	</div>
                 <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Baseline</label>
				    <label class="lang_indo control-label">Dasar</label>
				    <div class="controls">
				    	<input type="text" id="baseline" name="baseline" class="input-xlarge input-block-level"/>
				    	<span class="help-block" id="error_baseline"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Funding Source</label>
				    <label class="lang_indo control-label">Sumber Pendanaan</label>
				    <div class="controls">
				    	<input type="text" id="budsource" name="budsource" class="input-xlarge input-block-level"/>
					    <span class="help-block" id="error_budsource"></span>
				    </div>
				  </div>
				  <hr/>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">SDGs Indicator for Mapping</label>
				    <label class="lang_indo control-label">Indikator SDG untuk Mapping</label>
				    <div class="controls">
				    	<div class="accordion" id="accordion2">
							<div class="accordion-group">
							    <div class="accordion-heading">
							      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
							        <label class="lang_eng control-label" style="display:none">Select SDGs Indicator</label>
				    				<label class="lang_indo control-label">Pilih Indikator SDG</label>
							      </a>
							    </div>
							    <div id="collapseOne" class="accordion-body collapse">
							      <div class="accordion-inner">
							      </div>
							    </div>
							  </div>
						</div>
				    	<!-- <select name="sdg_indicator" id="sdg_indicator" class="input-block-level" style="width:100%" multiple="true">
				    		<option value="0">--select--</option>
	        				<option th:each="f:${sdgIndicator}" th:value="${f.id_goals}+'---'+${f.id_target}+'---'+${f.id_indicator}" th:text="${f.nm_indicator}"></option>
	        			</select> -->
					    <span class="help-block" id="error_unit"></span>
				    </div>
				  </div>
				  <!-- <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">5 Years Target</label>
				    <label class="lang_indo control-label">Target 5 Tahunan</label>
				    <input type="text" id="target_year1" name="target_year1" class="input-small" placeholder="First"/>
				    <input type="text" id="target_year2" name="target_year2" class="input-small" placeholder="Second"/>
				    <input type="text" id="target_year3" name="target_year3" class="input-small" placeholder="Third"/>
				    <input type="text" id="target_year4" name="target_year4" class="input-small" placeholder="Fourth"/>
				    <input type="text" id="target_year5" name="target_year5" class="input-small" placeholder="Fifth"/>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Baseline</label>
				    <label class="lang_indo control-label">Baseline</label>
				    <div class="controls">
				    	<input type="text" id="baseline" name="baseline" class="input-xlarge input-block-level"/>
				    	<span class="help-block" id="error_baseline"></span>
				    </div>
				  </div>
				  <div class="control-group">
				    <label class="lang_eng control-label" style="display:none">Funding Source</label>
				    <label class="lang_indo control-label">Funding Source</label>
				    <div class="controls">
				    	<input type="text" id="budsource" name="budsource" class="input-xlarge input-block-level"/>
					    <span class="help-block" id="error_budsource"></span>
				    </div>
				  </div> -->
			</div>
			<div class="modal-footer">
		    	<button class="btn tutup" data-dismiss="modal" aria-hidden="true">
		    		<span class="lang_eng" style="display:none">Close</span>
		    		<span class="lang_indo">Tutup</span>
		    	</button>
		    	<button class="btn btn-primary" id="submit">
		    		<span class="lang_eng" style="display:none">Submit</span>
		    		<span class="lang_indo">Simpan</span>
		    	</button>
		  	</div>
		</div>
    </div>
    <div th:include="admin/layout :: footer"></div>
</body>
<script th:inline="javascript" >
	// <![CDATA[
		//$(document).ready(function (e) {
			var token = $("meta[name='_csrf']").attr("content");
	        var header = $("meta[name='_csrf_header']").attr("content");
			var id_program = $('#id_program').val();
			var id_activity = $('#id_activity').val();
			//Bahasa
	        var titleDel = "Anda Yakin";
	        var messDel = "Menghapus Data?";
	        var buttDel = 'Ya, Hapus data ini!';
	        var titleOk	= "Hapus";
	        var messOk = "Data berhasil dihapus";
	        var messNOk = "Data tidak dapat dihapus";
	        var required = "Harus diisi";
	        function bhs(cek){
				if(cek){
					$(".lang_indo").show();
	        		$(".lang_eng").hide();
	        		titleDel = "Anda Yakin";
	        		messDel = "Menghapus Data?";
	        		buttDel = 'Ya, Hapus data ini!';
	        		titleOk	= "Hapus";
	    	        messOk = "Data berhasil dihapus";
	    	        messNOk = "Data tidak dapat dihapus";
	    	        required = "Harus diisi";
	        	}else{	    	        
	    	        $(".lang_indo").hide();
	        		$(".lang_eng").show();
	        		titleDel = "Are you sure";
	        		messDel = "Delete this data?";
	        		buttDel = 'Yes, Delete this data!';
	        		titleOk	= "Delete";
	    	        messOk = "Delete successful";
	    	        messNOk = "Can't delete data";
	    	        required = "Required";
	        	}
	        }
	        if(lang){
	        	bhs(lang=="0");
	        }else{
	        	bhs($('#fs').is(':checked'));
	        }
	        $('#fs').on('change', function(e){
	        	bhs($(this).is(':checked'));
	        	//table.ajax.reload( null, false );
	        	table.ajax.url(urls+'list-nsaIndicator/'+id_program+'/'+id_activity).load();
	        });
	        
	        var tahun = $("#id_monper").text().split(" - ");
	        var target="";
	        $("#tbody-target").html("");
	        for(i=tahun[0];i<=tahun[1];i++){
	        	target += '<tr>'+
                        	'<td><input type="text" name="target[][year]" class="input-block-level" value="'+($.trim(i))+'" readonly="true"/></td>'+
                        	'<td><input type="text" name="target[][nilai]" class="input-block-level"  value="" /></td>'+
                        '</tr>';
	        }
	        $("#tbody-target").append(target);
	        
	      //Indikator SDG untuk mapping
	        $.ajax({
                url: urls + 'list-sdgGoals',
                type: 'get',
                dataType: 'json',
                cache: false,
                async : false,
                success: function (response) {
                		var option = "<option value='0'>-- pilih -- </option>";
                		var cekbok = "";
                		for (var i = 0; i < response.content.length; i++) {
                			var nm_goals;
                			var id_goals=response.content[i].id;
                        	if($("#fs").is(':checked')){
                        		nm_goals = response.content[i].nm_goals;
    						}else{
    							nm_goals = response.content[i].nm_goals_eng;
    						}
                        	option += '<optgroup label="'+response.content[i].id_goals+' '+nm_goals+'">';
                        	cekbok += '<label for="menu'+id_goals +'" style="display:inline-block;white-space:nowrap;">'+
                        					'<input class="menu-master sdg-indikator" id="menu'+id_goals+'" name="sdg_indicator" data-id="'+id_goals+'" type="checkbox" style="vertical-align:middle" value="'+response.content[i].id+'---0---0">&nbsp;&nbsp;&nbsp;'+
				                            '<span style="vertical-align:middle">'+response.content[i].id_goals+". "+nm_goals+'</span>'+
				                      '</label><br/>';
                        	$.ajax({
                                url: urls + 'list-sdgTarget/'+response.content[i].id,
                                type: 'get',
                                dataType: 'json',
                                cache: false,
                                async : false,
                                success: function (result) {
                                	for (var j = 0; j < result.content.length; j++) {
                                		var nm_target;
                                		var id_target=result.content[j].id;
                                    	if($("#fs").is(':checked')){
                                    		nm_target = result.content[j].nm_target;
                						}else{
                							nm_target = result.content[j].nm_target_eng;
                						}
                                    	option += '<optgroup label="'+result.content[j].id_target+' '+nm_target+'">';
                                    	cekbok += '<label for="submenu'+id_target+'" style="display:inline-block;white-space:nowrap;margin-left:20px">'+
                                    					'<input data-goals="'+id_goals+'" data-id="'+id_target+'" class="sdg-indikator menu'+id_goals+' menu-slave" id="submenu'+id_target+'" type="checkbox" name="sdg_indicator" style="vertical-align:middle" value="'+response.content[i].id+'---'+result.content[j].id+'---0">&nbsp;&nbsp;&nbsp;'+
							                            '<span style="vertical-align:middle">'+response.content[i].id_goals+'.'+result.content[j].id_target+". "+nm_target+'</span>'+
							                      '</label><br/>';
                                    	$.ajax({
                                            url: urls + 'list-sdgIndicator/'+response.content[i].id+'/'+result.content[j].id,
                                            type: 'get',
                                            dataType: 'json',
                                            cache: false,
                                            async : false,
                                            success: function (result1) {
                                            	for (var k = 0; k < result1.content.length; k++) {
                                            		var nm_indicator;
                                            		var id_indicator=result1.content[k][0];
                                                	if($("#fs").is(':checked')){
                                                		nm_indicator = result1.content[k][4];
                            						}else{
                            							nm_indicator = result1.content[k][6];
                            						}
                                                	option += '<option value="'+response.content[i].id+'---'+result.content[j].id+'---'+result1.content[k][0]+'">'+result1.content[k][1]+' '+nm_indicator+'</option>';
                                                	cekbok += '<label for="submenu1'+id_indicator+'" style="display:inline-block;white-space:nowrap;margin-left:40px">'+
										                            '<input data-goals="'+id_goals+'" data-id="'+id_target+'" class="sdg-indikator menu'+id_goals+' menu-slave'+id_target+' menu-slave-1 menu-slave-1-'+id_target+'" id="submenu1'+id_indicator+'" type="checkbox" name="sdg_indicator" id="sdg_indicator" style="vertical-align:middle" value="'+response.content[i].id+'---'+result.content[j].id+'---'+result1.content[k][0]+'">&nbsp;&nbsp;&nbsp;'+
										                            '<span style="vertical-align:middle">'+response.content[i].id_goals+'.'+result.content[j].id_target+'.'+result1.content[k][1]+". "+nm_indicator+'</span>'+
										                      '</label><br/>';
                                            	}
                                            }
                                    	});
                                    	option += '</optgroup>';
                                	}
                                }
                        	});
                        	option += '</optgroup>';
                		}
                		$('#sdg_indicator').append(option);
                		$("#sdg_indicator").select2({
                		    dropdownParent: $("#myModal")
                		  });
                		$('.accordion-inner').append(cekbok);
                	}
                });
	      
	        $('.accordion-inner').on('click', '.menu-master', function(){
	        	var id = $(this).data('id');
	        	if ($(this).is(":checked")) {
	                $(".accordion-inner").find('.menu'+id).prop("checked", false);
	            } else {
	            	 $(".accordion-inner").find('.menu'+id).prop("checked", false);
	            }
	        });
	        
	        $('.accordion-inner').on('click', '.menu-slave', function(){
	        	var id = $(this).data('id');
	        	var goals = $(this).data('goals');
	        	if ($(this).is(":checked")) {
	                $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
	            } else {
	            	 $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
	            }
	        	
	        	if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
	                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
	            } else {
	            	 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
	            }
	        });
	        
	        $('.accordion-inner').on('click', '.menu-slave-1', function(){
	        	var id = $(this).data('id');
	        	var goals = $(this).data('goals');
	        	if ($(".menu-slave-1-"+id+":checked").length==$(".menu-slave-1-"+id).length) {
	                $(".accordion-inner").find('#submenu'+id).prop("checked", false);
	            } else {
	            	 $(".accordion-inner").find('#submenu'+id).prop("checked", false);
	            }
	        	
	        	if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
	                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
	            } else {
	            	 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
	            }
	        });
	        
	        function cekStatusMonper(){
	        	var status = "";
	        	$.ajax({
					type: "GET",
                    url: urls+'get-monPer/'+$('#id_monper').val(),
                    async:false,
                    success: function (result) {
                    	var val = result.content;
                    	status = val.status;
                    },
                });
	        	return status;
	        }
	        
			var table = $('#tabel-indicator').DataTable({
				responsive: true,
				sDom: 'lrtip',
				"bLengthChange": false,
				"cache": false,
				"autoWidth": true,
				"responsive":true,
				"ordering":false,
				"drawCallback": function( settings ) {
					if(cekStatusMonper()=="completed"){
		        		$('#showModal').hide();
		        		$('#tbody-indicator').find('.update, .detail, .delete').hide();
		        	}else{
		        		$('#showModal').show();
		        		$('#tbody-indicator').find('.update, .detail, .delete').show();
		        	}
				},
				"ajax": {
					"url": urls+'list-nsaIndicator/'+id_program+'/'+id_activity,
					dataSrc: 'content',
				},
				"searching": true,
				"columns": [
					{"data": function (row, data, index, display) {
							return "<div style='font-size:90%;'>"+[[${govProg.internal_code}]]+"."+[[${govActivity.internal_code}]]+"."+row[6]+"</div>";
					}},

					{"data": function (row, data, index, display) {
							var nama;
							if($("#fs").is(':checked')){
								nama = row[2]?row[2]:row[5];
							}else{
								nama = row[5]?row[5]:row[2];
							}
							return "<div style='font-size:90%;'>"+nama+"</div>";
						}},
					{"data": function (row, data, index, display) {
						return "<div style='font-size:90%;'>"+row[4]+"</div>";
					}},
					/* {"data": function (row, data, index, display) {
						var value = (row.target_year1)?row.target_year1:"";
						return "<div style='font-size:90%;'>"+value+"</div>";
					}},
					{"data": function (row, data, index, display) {
						var value = (row.target_year2)?row.target_year2:"";
						return "<div style='font-size:90%;'>"+value+"</div>";
					}},
					{"data": function (row, data, index, display) {
						var value = (row.target_year3)?row.target_year3:"";
						return "<div style='font-size:90%;'>"+value+"</div>";
					}},
					{"data": function (row, data, index, display) {
						var value = (row.target_year4)?row.target_year4:"";
						return "<div style='font-size:90%;'>"+value+"</div>";
					}},
					{"data": function (row, data, index, display) {
						var value = (row.target_year5)?row.target_year5:"";
						return "<div style='font-size:90%;'>"+value+"</div>";
					}},
					{"data": function (row, data, index, display) {
						return "<div style='font-size:90%;'>"+row.baseline+"</div>";
					}},
					{"data": function (row, data, index, display) {
						return "<div style='font-size:90%;'>"+row.budsource+"</div>";
					}}, */
					{"data": function (row, data, index, display) {
							return "<div style='text-align:center;'>"+
							'<button data-id="'+row[0]+'" type="button" title="detail" class="btn btn-success btn-mini detail"><i class="icon-edit"></i></button>'+
							'<button data-id="'+row[0]+'" type="button" title="update" class="btn btn-warning btn-mini update"><i class="icon-pencil"></i></button>'+
                            '<button data-id="'+row[0]+'" type="button" title="delete" class="btn btn-danger btn-mini delete"><i class="icon-trash"></i></button></div>';
						}}
				],
				"columnDefs": [
				],
				select: true
			});	
			
			$('#text-cari').on( 'keyup', function () {
				var val=$(this).val();
				table.search(val).draw();
			});
			
			function clearForm(){
				$('#id').val("");
				$('#id_nsa_indicator').val("").removeAttr("readonly");
				$('input[name="target[][nilai]"]').val("").removeAttr("readonly");
				$('#nm_indicator').val("").removeAttr("readonly");
				$('#nm_indicator_eng').val("").removeAttr("readonly");
				$('#unit').val("").removeAttr("disabled");
				$('#internal_code').val("").removeAttr("readonly");
				$('#sdg_indicator').val("").trigger('change');
				$('#sdg_indicator').removeAttr("disabled");
				$(".accordion-inner").find('.sdg-indikator').prop("checked", false);
				$(".accordion-inner").find('.sdg-indikator').removeAttr("disabled");
				$('#baseline').val("").removeAttr("readonly");
				$('#budsource').val("").removeAttr("readonly");
				$('.control-group').removeClass('error');
				$('.help-block').text("");
			}
			
			$('#myModal').on('hidden.bs.modal',function(){
				$('#hide_kode_internal').hide();
			});
			
			$('#submit').on('click', function(){
				var id = $('#id').val();
				var id_program = $('#id_program').val();
				var id_activity = $('#id_activity').val();
				var id_nsa_indicator = $('#id_nsa_indicator').val();
				var nm_indicator = $('#nm_indicator').val();
				var nm_indicator_eng = $('#nm_indicator_eng').val();
				var unit = $('#unit').val();
				var internal_code = $('#internal_code').val();
				if(nm_indicator==""){
					nm_indicator=nm_indicator_eng;
				}
				if(nm_indicator_eng==""){
					nm_indicator_eng=nm_indicator;
				}
				/* if(internal_code==""){
					internal_code = id_nsa_indicator;
				} */
				var sdg_indicator;
				var sdg_indicator_val = [];
		        $.each($("input[name='sdg_indicator']:checked"), function(){
		        	sdg_indicator_val.push($(this).val());
		        });
				if(sdg_indicator_val.length>0){
					sdg_indicator = sdg_indicator_val.toString();
				}else{
					sdg_indicator = '0';
				}
				var baseline = $('#baseline').val();
				var budsource = $('#budsource').val();
				$('.control-group').removeClass('error');
				$('.help-block').text("");
				var cek = 0;
				/* if (id_nsa_indicator == ""){
                    $("#error_id_nsa_indicator").parents(".control-group").first().addClass("error");
                    $("#error_id_nsa_indicator").text(required);
                    cek += 1;
                } */
				/* if (nm_indicator == ""){
                    $("#error_nm_indicator").parents(".control-group").first().addClass("error");
                    $("#error_nm_indicator").text(required);
                    cek += 1;
                } */
				if (unit == ""){
                    $("#error_unit").parents(".control-group").first().addClass("error");
                    $("#error_unit").text(required);
                    cek += 1;
                }
				if(cek==0){
					var data = JSON.stringify({
						'id':id,
						'id_program':id_program,
						'id_activity':id_activity,
						'id_nsa_indicator':id_nsa_indicator,
						'nm_indicator':nm_indicator,
						'nm_indicator_eng':nm_indicator_eng,
						'unit':unit,
						'internal_code':internal_code,
						});
					$.ajax({
						type: "POST",
	                    url: urls+'save-nsaIndicator/'+sdg_indicator+'/'+$('#id_monper').val()+'/'+$('#id_prov').val(),
	                    beforeSend : function(xhr){
	                    	xhr.setRequestHeader(header,token);
	                    },
	                    headers:{'Accept':'application/json','Content-Type':'application/json'},
						data: data,
	                    success: function (result) {
	                    	//table.ajax.url(urls+'list-nsaIndicator/'+id_program+'/'+id_activity).load();
	                    	table.ajax.reload( null, false );
	                    	var id_nsa_indicator = result.content;
	                    	var target =  $('#form-target').serializeObject();
	                    	$.ajax({
	                            type    :"POST",
	                            url     :urls+'save-nsaTarget/'+id_nsa_indicator+'/'+$('#id_role').val(),
	                            headers :{'Accept':'application/json','Content-Type':'application/json'},
	                            data    : JSON.stringify({target}),
	                            beforeSend : function(xhr){
	                            	xhr.setRequestHeader(header,token);
	                            },
	                            success :function(result){
	                            },             
	                         });
	                    	var funding = JSON.stringify({
	    						'id_nsa_indicator':id_nsa_indicator,
	    						'id_monper':$('#id_monper').val(),
	    						'baseline':baseline,
	    						'funding_source':budsource
	    						});
	                    	$.ajax({
	                            type    :"POST",
	                            url     :urls+'save-nsaFunding',
	                            headers :{'Accept':'application/json','Content-Type':'application/json'},
	                            data    : funding,
	                            beforeSend : function(xhr){
	                            	xhr.setRequestHeader(header,token);
	                            },
	                            success :function(result){
	                            },             
	                         });
	                    	$('#myModal').modal('hide');
	                    	clearForm();
	                    },
	                });
				}
			});
			
			$('#tbody-indicator').on('click', '.update', function(){
				var id = $(this).attr('data-id');
				$.ajax({
					type: "GET",
                    url: urls+'get-nsaIndicator/'+id,
                    success: function (result) {
                    	var val = result.content;
                    	$('#id').val(val.id);
                    	$('#id_nsa_indicator').val(val.id_nsa_indicator).attr("readonly",true);
        				$('#nm_indicator').val(val.nm_indicator);
        				$('#nm_indicator_eng').val(val.nm_indicator_eng);
        				$('#unit').val(val.unit);
        				$('#internal_code').val(val.internal_code?val.internal_code:'');
        				var privilege = [[${privilege}]];
        				if(privilege=='ADMIN' || privilege=='SUPER'){
        	                 $('#hide_kode_internal').show();
        	            }
        				$.ajax({
        					type: "GET",
                            url: urls+'list-getNsaMapByGovInd/'+val.id,
                            success: function (hasil) {
                            		var val = hasil.content;
                            		var selectedValues = new Array();
                            		for(var i=0;i<val.length;i++){
                            			selectedValues[i] = val[i].id_goals+'---'+(val[i].id_target?val[i].id_target:0)+'---'+(val[i].id_indicator?val[i].id_indicator:0);
                            			$(".accordion-inner").find('.sdg-indikator[value="'+selectedValues[i]+'"]').prop("checked", true);
                            		}
                            	}
                        });
						$('#myModal').modal('show');
						var tahun = $("#id_monper").text().split(" - ");
				        var target="";
				        $("#tbody-target").html("");
				        for(i=tahun[0];i<=tahun[1];i++){
				        	var nilai="";
				        	$.ajax({
	        					type: "GET",
	                            url: urls+'get-nsaTarget/'+val.id+'/'+($.trim(i)),
	                            async:false,
	                            success: function (hasil) {
	                            		var val = hasil.content;
	                            		if(val.length>0){
	                            			nilai = val[0]["value"];	
	                            		}
	                            	}
	                        });
				        	target += '<tr>'+
			                        	'<td><input type="text" name="target[][year]" class="input-block-level" value="'+($.trim(i))+'" readonly="true"/></td>'+
			                        	'<td><input type="text" name="target[][nilai]" class="input-block-level"  value="'+nilai+'" /></td>'+
			                        '</tr>';
				        }
				        $("#tbody-target").append(target);
				        $.ajax({
        					type: "GET",
                            url: urls+'get-nsaFunding/'+val.id+'/'+$("#id_monper").val(),
                            async:false,
                            success: function (hasil) {
                            		var val = hasil.content;
                            		if(val.length>0){
                            			$('#baseline').val(val[0]["baseline"]);
                            			$('#budsource').val(val[0]["funding_source"]);
                            		}
                            	}
                        });
                    },
                })
             }).on('click', '.detail', function(){
				var id = $(this).attr('data-id');
				$.ajax({
					type: "GET",
                    url: urls+'get-nsaIndicator/'+id,
                    success: function (result) {
                    	var val = result.content;
                    	$('#id').val(val.id);
                    	$('#id_nsa_indicator').val(val.id_nsa_indicator).attr("readonly",true);
        				$('#nm_indicator').val(val.nm_indicator).attr("readonly",true);
        				$('#nm_indicator_eng').val(val.nm_indicator_eng).attr("readonly",true);
        				$('#unit').val(val.unit).attr("disabled",true);
        				$('#internal_code').val(val.internal_code?val.internal_code:'').attr("readonly",true);
        				var privilege = [[${privilege}]];
        				if(privilege=='ADMIN' || privilege=='SUPER'){
        	                 $('#hide_kode_internal').show();
        	             }
        				$.ajax({
        					type: "GET",
                            url: urls+'list-getNsaMapByGovInd/'+val.id,
                            success: function (hasil) {
                            		var val = hasil.content;
                            		var selectedValues = new Array();
                            		for(var i=0;i<val.length;i++){
                            			selectedValues[i] = val[i].id_goals+'---'+(val[i].id_target?val[i].id_target:0)+'---'+(val[i].id_indicator?val[i].id_indicator:0);
                            			$(".accordion-inner").find('.sdg-indikator[value="'+selectedValues[i]+'"]').prop("checked", true);
                            		}
                            		$(".accordion-inner").find('.sdg-indikator').attr("disabled",true);
                            	}
                        });
						$('#myModal').modal('show');
						var tahun = $("#id_monper").text().split(" - ");
				        var target="";
				        $("#tbody-target").html("");
				        for(i=tahun[0];i<=tahun[1];i++){
				        	var nilai="";
				        	$.ajax({
	        					type: "GET",
	                            url: urls+'get-nsaTarget/'+val.id+'/'+($.trim(i)),
	                            async:false,
	                            success: function (hasil) {
	                            		var val = hasil.content;
	                            		if(val.length>0){
	                            			nilai = val[0]["value"];	
	                            		}
	                            	}
	                        });
				        	target += '<tr>'+
			                        	'<td><input type="text" name="target[][year]" class="input-block-level" value="'+($.trim(i))+'" readonly="true"/></td>'+
			                        	'<td><input type="text" name="target[][nilai]" class="input-block-level"  value="'+nilai+'" readonly="true"/></td>'+
			                        '</tr>';
				        }
				        $("#tbody-target").append(target);
				        $.ajax({
        					type: "GET",
                            url: urls+'get-nsaFunding/'+val.id+'/'+$("#id_monper").val(),
                            async:false,
                            success: function (hasil) {
                            		var val = hasil.content;
                            		if(val.length>0){
                            			$('#baseline').val(val[0]["baseline"]).attr("readonly",true);
                            			$('#budsource').val(val[0]["funding_source"]).attr("readonly",true);
                            		}
                            	}
                        });
				        $('#baseline').attr("readonly",true);
				        $('#budsource').attr("readonly",true);
                    },
                })
             }).on('click', '.delete', function(){
				var id = $(this).attr('data-id');
				swal({
                    title: titleDel,
                    text: messDel,
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: buttDel
                }).then(function () {
                	$.ajax({
    					type: "DELETE",
                        url: urls+'delete-nsaIndicator/'+id,
                        beforeSend : function(xhr){
                        	xhr.setRequestHeader(header,token);
                        },
                        success: function (result) {
                        	swal(titleOk,messOk,'success');
                        	table.ajax.reload( null, false );
                        	//table.ajax.url(urls+'list-nsaIndicator/'+id_program+'/'+id_activity).load();
                        },
                        error:function (result) {
                        	swal(titleOk,messNOk,'error');
                        },
                    })
                }, function (dismiss) {
                    if (dismiss === 'cancel') {
                    }
                })
             });
			
			$('.tutup').on('click', function(){
				clearForm();
			});
			
			var privilege = [[${privilege}]];
            /* $('#id_program').on('keyup keypress blur change',function(){
                $('#internal_code').val($(this).val());
            }); */
            $('#hide_kode_internal').hide();
            if(privilege=='USER'){
                $('#hide_kode_internal').hide();
            }
		//});
		// ]]>
</script>
</html>