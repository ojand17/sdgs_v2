<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head th:include="admin/layout :: header">
    <title th:text="Manajemen Role"></title>
</head>
<body>
	<title>Report / GRI/OJK</title>
    <div th:include="admin/layout :: menu"></div>

    <div id="content">  
        <div id="content-header">
            <div id="breadcrumb"> <a href="#" title="Go to Home" class="tip-bottom"><i class="icon-home"></i>GRI / OJK</a></div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                            <form class="form-horizontal">
                                <div class="control-group">
                                     <span> Company :  </span>
                                    <select name="company" id="company">
                                        
                                    </select>
                                    <span> Year : </span>
                                    <select name="year" id="year">
                                        
                                    </select>
                                    <button class="btn btn-primary" type="button" id="show">
                                        <i class="icon-search"></i>
                                    </button>
                                    <button class="btn btn-success" type="button" id="showpdf_pt">Pdf</button>
                                    <!--<button class="btn btn-success" type="button" id="showpdf_th">Pdf</button>-->
                                </div>
                            </form>
                        </div>
            <div class="row-fluid">
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-user"></i></span>
                        <h5>
                        	<span class="lang_eng" style="display:none">Data Entry / Sustainibility Report </span>
                        	<span class="lang_indo">Input Data / Laporan Keberlanjutan Form GRI/OJK</span>
                        </h5>
                    </div>
                    <div class="widget-content">
                        
                        <div class="pull-left" style="width:100%">
                            <div class="input-append" style="margin-right:50px;">
                                <input placeholder="Search..." class="span12" id="text-cari" type="text"/>
                                <span class="add-on"><i class="icon-search"></i></span>
                            </div>
                           
                        </div>
                        <div class="row-fluid">
                            <div class="span12">
                                <div class="table-responsive" id="content-table">
                                    <table id="tabel-role" class="table table-striped table-bordered">
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" style="width:1000px!important;left:35%!important">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="float:right">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="exampleModalLabel"><i class="icon-cog"></i> 
                        <span class="lang_eng" style="display:none">Detail</span>
                        <span class="lang_indo">Detail</span>
                    </h3>
                </div>
                <div class="modal-body">
                    <table id="detailGri" class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">Code</span>
                                    <span class="lang_indo">Kode</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">POJK</span>
                                    <span class="lang_indo">POJK</span>
                                </th>
                                 <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">SDGS</span>
                                    <span class="lang_indo">SDGS</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">SDGS Description</span>
                                    <span class="lang_indo">SDGS Descripsi</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">GRI</span>
                                    <span class="lang_indo">GRI</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">GRI Description</span>
                                    <span class="lang_indo">GRI Deskripsi</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">Year</span>
                                    <span class="lang_indo">Tahun</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">Company</span>
                                    <span class="lang_indo">Perusahaan</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">Value</span>
                                    <span class="lang_indo">Nilai</span>
                                </th>
                                <th style="text-align:center;font-size:80%;">
                                    <span class="lang_eng" style="display:none">Unit</span>
                                    <span class="lang_indo">Unit</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tbody-role"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">
                        <span class="lang_eng" style="display:none">Close</span>
                        <span class="lang_indo">Tutup</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="myModalPdf" class="modal hide fade" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" style="">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="float:right">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="exampleModalLabel"><i class="icon-download"></i> 
                        <span class="lang_eng" style="display:none">Download Pdf</span>
                        <span class="lang_indo">Download Pdf</span>
                    </h3>
                </div>
                <div class="modal-body">
                    <table id="tabsdg" class='table table-striped table-bordered'>
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">
                        <span class="lang_eng" style="display:none">Close</span>
                        <span class="lang_indo">Tutup</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div th:include="admin/layout :: footer"></div>
</body>
<script th:inline="javascript">
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    
    
    console.log(data_filter);
  //Bahasa
    var titleDel = "Anda Yakin";
    var messDel = "Menghapus Data?";
    var buttDel = 'Ya, Hapus data ini!';
    var titleOk	= "Hapus";
    var messOk = "Data berhasil dihapus";
    var messNOk = "Data tidak dapat dihapus";
    var required = "Harus diisi";
    var messRole = "Nama Role Sudah ada";
    var mess1Role = "Role Sudah ada";
    function bhs(cek){
		if(cek){
			$(".lang_indo").show();
    		$(".lang_eng").hide();
    		titleDel = "Anda Yakin";
    		messDel = "Menghapus Data?";
    		buttDel = 'Ya, Hapus data ini!';
    		titleOk	= "Hapus";
	        messOk = "Data berhasil dihapus";
	        messNOk = "Data tidak dapat dihapus";
	        required = "Harus diisi";
	        messRole = "Nama Role Sudah ada";
	        mess1Role = "Role Sudah ada";
    	}else{	    	        
	        $(".lang_indo").hide();
    		$(".lang_eng").show();
    		titleDel = "Are you sure";
    		messDel = "Delete this data?";
    		buttDel = 'Yes, Delete this data!';
    		titleOk	= "Delete";
	        messOk = "Delete successful";
	        messNOk = "Can't delete data";
	        required = "Required";
	        messRole = "The name Role already exists";
	        mess1Role = "Role already exists";
    	}
    }
    if(lang){
    	bhs(lang=="0");
    }else{
    	bhs($('#fs').is(':checked'));
    }
    
    $('#fs').on('change', function(e){
    	bhs($(this).is(':checked'));
    	loadMenuSelect();
    });
    
    
    
    
    var privilege = [[${privilege}]];
    var id_prov = [[${id_prov}]];
    var id_role = [[${id_role}]];
    var data_filter   = [[${data}]];
    function formatResult(node) {
            var $result = $('<span style="padding-left:' + (20 * node.level) + 'px;">' + node.text + '</span>');
            return $result;
          };
    
    //download pdf
    
    $('#showpdf_pt').on('click',function(){
        var company_id = $('#company').val();
        if(company_id==0){
            grid_pdf_pt();
            $('#myModalPdf').modal('show');
        }else{
            grid_pdf_th();
            $('#myModalPdf').modal('show');
        }
    });
    
    
    function grid_pdf_pt() {
        $("#tabsdg > tbody").html("");
        $("#tabsdg > thead").html("");
        
        var company_id  = $('#company').val();
        var tahun       = $('#year').val();
        
        var th = "<tr>";
//            th += "<th id='th_disagre' style='vertical-align:middle;width:10%;' rowspan='4'>Disaggregasi</th>";
        th += "<th>Company</th>";
        th += "<th>Action</th>";
        
        th += "</tr>";
        $("#tabsdg > thead").append(th);
        
        $.ajax({
            url: urls + "get_data_gri_pt",
            type: 'get',
            data: {'year':tahun},
            cache: false,
            async: false,
            success: function (data_gri) {
                var array = data_gri.content;
                if (array != '') {
                    for (i in array) {
                        var tb_sdg = '<tr> <td>'+array[i][1]+'</td> <td><a download="file.pdf" href="data:application/pdf;base64,'+array[i][2]+'" class="btn btn-warning btn-mini" target="_blank">Pdf</a></td> </tr>';
                        $("#tabsdg > tbody").append(tb_sdg);
                        
                    }
                }
            }
        });
        
    }
    
    function grid_pdf_th() {
        
        $("#tabsdg > tbody").html("");
        $("#tabsdg > thead").html("");
        
        var company_id = $('#company').val();
        var tahun = $('#year').val();
        
        var th = "<tr>";
//            th += "<th id='th_disagre' style='vertical-align:middle;width:10%;' rowspan='4'>Disaggregasi</th>";
        th += "<th>Year</th>";
        th += "<th>Action</th>";
        
        th += "</tr>";
        $("#tabsdg > thead").append(th);
        
        $.ajax({
            url: urls + "get_data_gri_th",
            type: 'get',
            data: {'company':company_id},
            cache: false,
            async: false,
            success: function (data_gri) {
                var array = data_gri.content;
                if (array != '') {
                    for (i in array) {
                        var tb_sdg = '<tr> <td>'+array[i][1]+'</td> <td><a download="file.pdf" href="data:application/pdf;base64,'+array[i][2]+'" class="btn btn-warning btn-mini" target="_blank">Pdf</a></td> </tr>';
                        $("#tabsdg > tbody").append(tb_sdg);
                        
                    }
                }
            }
        });
        
    }
    
    
    
    
    //end download pdf
    
    if(data_filter.company.length!=0){
        var data_company = [{'id':'0','text':'ALL','level':'1'}]
       $.each(data_filter.company,function(i,x){
             var obj = {'id':x,'text':x,'level':'1'}             
            data_company.push(obj)
        }); 
    }
     if(data_filter.tahun.length!=0){
         var data_year = [];
         $.each(data_filter.tahun,function(i,x){
             var obj = {'id':x,'text':x,'level':'1'}             
            data_year.push(obj)
        });
     }     
   
        
    $("#company").select2({
          placeholder: 'Select an option',
//          width: "70%",
          data: data_company,
          formatSelection: function(item) {
            return item.text
          },
          formatResult: function(item) {
            return item.text
          },
          templateResult: formatResult,
        });  
    
   /*  $('#company').on('change',function(){
        var id = $(this).val();
        alert(id);
            if(id==0){
                console.log("ALL");
                 $("#year").select2({
                    placeholder: 'Select an option',
          //          width: "70%",
                    data: data_year,
                    formatSelection: function(item) {
                      return item.text
                    },
                    formatResult: function(item) {
                      return item.text
                    },
                    templateResult: formatResult,
                  }).trigger('change');
        }else{
//            $('#year').select2('data', null);
            $('#year').empty().trigger("change");
        }
    }); */
    
   $("#year").select2({
            placeholder: 'Select an option',
        //          width: "70%",
            data: data_year,
            formatSelection: function(item) {
              return item.text
            },
            formatResult: function(item) {
              return item.text
            },
            templateResult: formatResult,
    });
    
    $('#show').on('click',function(){
       var company_id = $('#company').val();
       var uuid = uuidv4();
       $("#content-table").html("");
       $("#content-table").html('<table id="'+uuid+'" class="table table-striped table-bordered"></table>');
       if(company_id==0){
           var values = $("#company>option").map(function() { return $(this).val(); });
           var tahun = $('#year').val();
           var data_column =[{ "title": "POJK","targets": 0 },
                                      { "title": "KODE" },
                                      { "title": "SDGS" },
                                      { "title": "SDGS DESCRIPTION" },
                                      { "title": "GRI" },
                                      { "title": "GRI DESC" },
                                      { "title": "UNIT" }];
                                  
           function getAllCompany(selected, thangi) {
                return $.ajax({
                    url: urls+'get-all-company/gri-ojk/'+tahun ,
                    data: {
                        issession: 1,
                        selector: selector
                    },
                    // dataType: "json",
                    async: false,
                    error: function () {
                        alert("Error occured")
                    }
                });

            }
            var selector = !0;
            var ajaxObj = getAllCompany(selector, $(this).val());
            var allCompany = JSON.parse(ajaxObj.responseText);
            
            
            var subquery ="";
           $.each(allCompany.content,function(i,x){
               if(x!=0){
                  subquery  +=",(SELECT b.value FROM trx_excell  b WHERE b.company_name = '"+x+"' AND  b.year = '"+tahun+"' AND  b.kode=a.kode) AS '"+x+"' ";
                  data_column.push({"title":x}); 
               }
           });
           var query = "SELECT a.pjok,a.kode,a.sdgs,a.sdgs_desc,a.gri,a.gri_desc,a.unit  "+subquery+"FROM excell a";
           
           function getAllRow(selected, thangi) {
                        return $.ajax({
                            url: urls+'get-all-row-company/gri-ojk/'+query ,
                            data: {
                                issession: 1,
                                selector: selector
                            },
                            // dataType: "json",
                            async: false,
                            error: function () {
                                alert("Error occured")
                            }
                        });

                    }
                    var selector = !0;
                    var ajaxObj = getAllRow(selector, $(this).val());
                    var allRow = JSON.parse(ajaxObj.responseText); 
//                 var datarow =[];
//                 $.each(allRow.content,function(i,x){
//                     datarow.push(x);
//                 });
//                 console.log(datarow);
                $('#'+uuid).DataTable({
                        responsive: true,
                        sDom: 'Brtip',
                        "retrieve": true,
                        "bLengthChange": false,
                        "cache": false,
                        "autoWidth": true,
                        "responsive":true,
                        "ordering": false,
                        "info":     false,
                        "searching": true,
                        buttons: [
        		        	{
        		        	    extend: 'print',
        		        	    text: 'Print',
        		        	},
        		        	{
        		        		extend: 'excelHtml5',
        		        		filename: 'GRI/OJK',
        		        		text: 'Save as Excel',
        		        		exportOptions: {
        		        		    format: {
        		        		        body: function(data, column, row) {
        		        		        	data = data.replace(/<br\s*\/?>/ig, '\r\n');
        		        		            data = data.replace(/<.*?>/g, "");
        		        		            data = data.replace("&amp;", "&");
        		        		            data = data.replace("&nbsp;", "");
        		        		            data = data.replace("&nbsp;", "");
        		        		            return data;
        		        		        }
        		        		    }
        		        		}
        		        	},
        		        ],
                        "aaData" : allRow.content,
                        "aoColumns":data_column,
//                        "data": datarow,
                        select: true
                    });
       }else{
           
           function getLastYear(selected, thangi) {
                        return $.ajax({
                            url: urls+'get-last-year-company/gri-ojk/'+company_id ,
                            data: {
                                issession: 1,
                                selector: selector
                            },
                            // dataType: "json",
                            async: false,
                            error: function () {
                                alert("Error occured")
                            }
                        });

                    }
                    var selector = !0;
                    var ajaxObj = getLastYear(selector, $(this).val());
                    var lastYear = JSON.parse(ajaxObj.responseText);
                    var year = lastYear.content[0]-2;
                    var subquery ="";
                    var data_column =[{ "title": "POJK","targets": 0 },
                                      { "title": "KODE" },
                                      { "title": "SDGS" },
                                      { "title": "SDGS DESCRIPTION" },
                                      { "title": "GRI" },
                                      { "title": "GRI DESC" },
                                      { "title": "UNIT" }];
                   $.each(lastYear.content,function(i,x){
                       subquery  +=",(SELECT b.value FROM trx_excell  b WHERE b.company_name = '"+company_id+"' AND  b.year = '"+x+"' AND  b.kode=a.kode) AS '"+x+"' ";
                        data_column.push({"title":x});
                   });

                    
                    var query = "SELECT a.pjok,a.kode,a.sdgs,a.sdgs_desc,a.gri,a.gri_desc,a.unit  "+subquery+"FROM excell a";
            
                
               function getAllRow(selected, thangi) {
                        return $.ajax({
                            url: urls+'get-all-row-company/gri-ojk/'+query ,
                            data: {
                                issession: 1,
                                selector: selector
                            },
                            // dataType: "json",
                            async: false,
                            error: function () {
                                alert("Error occured")
                            }
                        });

                    }
                    var selector = !0;
                    var ajaxObj = getAllRow(selector, $(this).val());
                    var allRow = JSON.parse(ajaxObj.responseText); 
//                 var datarow =[];
//                 $.each(allRow.content,function(i,x){
//                     datarow.push(x);
//                 });
//                 console.log(datarow);
                $('#'+uuid).DataTable({
                        responsive: true,
                        sDom: 'Brtip',
                        "retrieve": true,
                        "bLengthChange": false,
                        "cache": false,
                        "autoWidth": true,
                        "responsive":true,
//                        "paging":   false,
                        "ordering": false,
                        "info":     false,
//                        "ajax": {
//                            "url": urls+'get-all-row-company/gri-ojk/'+query ,
//                            dataSrc: 'content',
//                        },
                        "searching": true,
                        "aaData" : allRow.content,
                        "aoColumns":data_column,
                        buttons: [
        		        	{
        		        	    extend: 'print',
        		        	    text: 'Print',
        		        	},
        		        	{
        		        		extend: 'excelHtml5',
        		        		filename: 'GRI/OJK',
        		        		text: 'Save as Excel',
        		        		exportOptions: {
        		        		    format: {
        		        		        body: function(data, column, row) {
        		        		        	data = data.replace(/<br\s*\/?>/ig, '\r\n');
        		        		            data = data.replace(/<.*?>/g, "");
        		        		            data = data.replace("&amp;", "&");
        		        		            data = data.replace("&nbsp;", "");
        		        		            data = data.replace("&nbsp;", "");
        		        		            return data;
        		        		        }
        		        		    }
        		        		}
        		        	},
        		        ],
//                        "data": datarow,
                        select: true
                    });
                    
       }
        
    });
    
    if((privilege=="SUPER" || privilege=="ADMIN") && id_prov=="000"){
    	$('#addNew').show();
    	$('#prov').removeAttr('readonly');
    }else if(privilege=="ADMIN" && id_prov!="000"){
    	$('#addNew').show();
    	$('#prov').val(id_prov).attr('disabled', true);
    }else{
    	$('#addNew').hide();
    }
    
    if(privilege=="ADMIN"){
      $("#privilege option[value='ADMIN']").remove();
    }
    
//    $('#id_prov').on('change', function(){
//    	var id = $(this).val();
//    	table.ajax.url(urls+'manajemen/list-role/'+id).load();
//    });
    
    //Load Select Menu
    loadMenuSelect();
    function loadMenuSelect(){
    	$.ajax({
            url: urls + 'menu',
            type: 'get',
            dataType: 'json',
            cache: false,
            async : false,
            success: function (response) {
                $('.menu').empty();
                var menu="";
                for (var i = 0; i < response.length; i++) {
                	var bhsMenu="";
                	if(lang){
                    	if(lang=="0"){
                    		bhsMenu = response[i].menu_indo;
                    	}else{
                    		bhsMenu = response[i].menu_eng;
                    	}
                    }else{
                    	if($('#fs').is(':checked')){
                    		bhsMenu = response[i].menu_indo;
                    	}else{
                    		bhsMenu = response[i].menu_eng;
                    	}
                    }
                	menu += '<label for="menu'+response[i].id_menu +'" style="display:inline-block;white-space:nowrap;margin-left:20px">'+
                                  '<input class="menu-master" id="menu'+response[i].id_menu+'" data-id="'+response[i].id_menu+'" type="checkbox" name="menu" value="'+response[i].id_menu +'" style="vertical-align:middle">&nbsp;&nbsp;&nbsp;'+
                                  '<span style="vertical-align:middle">'+bhsMenu+'</span>'+
                            '</label><br/>';
                                    
                	$.ajax({
                        url: urls + 'submenu',
                        type: 'get',
                        data: 'id=' + response[i].id_menu,
                        dataType: 'json',
                        cache: false,
                        async : false,
                        success: function (result) {
                            for (var j = 0; j < result.length; j++) {
                            	var bhsSubMenu="";
                            	if(lang){
                                	if(lang=="0"){
                                		bhsSubMenu = result[j].submenu_indo;
                                	}else{
                                		bhsSubMenu = result[j].submenu_eng;
                                	}
                                }else{
                                	if($('#fs').is(':checked')){
                                		bhsSubMenu = result[j].submenu_indo;
                                	}else{
                                		bhsSubMenu = result[j].submenu_eng;
                                	}
                                }
                            	menu += '<label for="submenu'+result[j].id_submenu+'" style="display:inline-block;white-space:nowrap;margin-left:40px">'+
    			                            '<input data-id="'+response[i].id_menu+'" class="menu'+response[i].id_menu+' menu-slave" id="submenu'+result[j].id_submenu+'" type="checkbox" name="submenu" value="'+result[j].id_submenu +'" style="vertical-align:middle">&nbsp;&nbsp;&nbsp;'+
    			                            '<span style="vertical-align:middle">'+bhsSubMenu+'</span>'+
    			                      '</label><br/>';
                            }
                        }
                    });
                }
                $('.menu').append(menu);
            }
        });
    }
    
    $('.menu').on('click', '.menu-master', function(){
    	var id = $(this).data('id');
    	if ($(this).is(":checked")) {
            $(".menu").find('.menu'+id).prop("checked", true);
        } else {
        	 $(".menu").find('.menu'+id).prop("checked", false);
        }
    });
    
    $('.menu').on('click', '.menu-slave', function(){
    	var id = $(this).data('id');
    	if ($(".menu-slave:checked").length>0) {
            $(".menu").find('#menu'+id).prop("checked", true);
        } else {
        	 $(".menu").find('#menu'+id).prop("checked", false);
        }
    });
	if(privilege=="USER"){
		$('#addNew').hide();
	}
   
    $('#text-cari').on( 'keyup', function () {
       var idtable =  $('#content-table').find('table').attr('id');
       var table = $('#'+idtable).DataTable();
       var val=$(this).val();
       table.search(val).draw();
    });
    
    function clearForm(){
		$('#nm_unit').val("").removeAttr("readonly");
                $('#id_unit').val("").removeAttr("readonly");
                $('#submit').removeAttr("disabled");
		$('.control-group').removeClass('error');
		$('.help-block').text("");
	}
	
	$('#myModal').on('hidden.bs.modal',function(){
		clearForm();
	});
	
	$('#submit').on('click', function(){
                var id           = $('#id').val();
		var description  = $('#description').val();
                var approval     = $('input[name=approval]:checked').val();
                
		$('.control-group').removeClass('error');
		$('.help-block').text("");
		var cek = 0;
		
		if (approval == ""){
                    $("#error_nm_role").parents(".control-group").first().addClass("error");
                    $("#error_nm_role").text(required);
                    cek += 1;
                }
//		console.log(id_unit);return false;
		if(cek==0){
                    
    			var data = JSON.stringify({
                                'id':id,
    				'description':description,
                                'approval':approval
    				});
//                        console.log(data);return false;
    			$.ajax({
    				type: "POST",
                                url: urls+'save-approval/gri-ojk',
                                contentType: false,
                                processData: false,
                                beforeSend : function(xhr){
                                    xhr.setRequestHeader(header,token);
                                },
                                headers:{'Accept':'application/json','Content-Type':'application/json'},
                                data: data,
                                success: function (result) {
            //                        console.log(result.readyState);
                                    table.ajax.url(urls+'list-entry/gri-ojk/').load();
                                    $('#myModal').modal('hide');
                                },
                            });
    		}
	});
	var table2 = $('#detailGri').DataTable({
                        responsive: true,
                        sDom: 'Brtip',
                        "bLengthChange": false,
                        "cache": false,
                        "autoWidth": true,
                        "responsive":true,
                        buttons: [
        		        	{
        		        	    extend: 'print',
        		        	    text: 'Print',
        		        	},
        		        	{
        		        		extend: 'excelHtml5',
        		        		filename: 'GRI/OJK',
        		        		text: 'Save as Excel',
        		        		exportOptions: {
        		        		    format: {
        		        		        body: function(data, column, row) {
        		        		        	data = data.replace(/<br\s*\/?>/ig, '\r\n');
        		        		            data = data.replace(/<.*?>/g, "");
        		        		            data = data.replace("&amp;", "&");
        		        		            data = data.replace("&nbsp;", "");
        		        		            data = data.replace("&nbsp;", "");
        		        		            return data;
        		        		        }
        		        		    }
        		        	,
        		        		}
        		        	},
        		        ],
                        "ajax": {
                            "url": '/sdg/admin/get-report/gri-ojk',
                            dataSrc: 'content',
                        },
                        "searching": true,
                        "columns": [
                            {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[0])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[1])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[2])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[3])+"</div>";}
                            },  {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[4])+"</div>";}
                            },  {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[5])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[6])+"</div>";}
                            },
                             {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[7])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[8])+"</div>";}
                            },
                              {"data": function (row, data, index, display) {
                                return "<div style='font-size:90%;'>"+(row[9])+"</div>";}
                            },
                        ],
                        "columnDefs": [
                        ],
                        select: true
                    });
                $('#tbody-role').on('click', '.update', function(){
                    var year    = $(this).attr('data-year');
                    var company = $(this).attr('data-company');
                        table2.ajax.url(urls+'get-report/gri-ojk/'+year+'/'+company).load(function(){
                            $('#myModal').modal('show');
                        });
                        
                 });
    function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
              var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
              return v.toString(16);
            });
        }
</script>
</html>