<!DOCTYPE html>
<html lang="en"
      xmlns:="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<head th:include="admin/layout :: header">
    <title th:text="SDG Indicator Monitoring">Report Evaluation</title>
</head>
<body>
<title>
	Report Best Practice
</title>
<div th:include="admin/layout :: menu"></div>
<div id="content">
    <div id="content-header">
        <div id="breadcrumb" class="lang_indo"> <a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>Laporan / Praktik Terbaik</a></div>
        <div id="breadcrumb" class="lang_eng" style="display:none"> <a href="#" title="Ke Home" class="tip-bottom"><i class="icon-home"></i>Report / Best Practice</a></div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
        	<form id="form-sdgGoals">
        		<div class="row-fluid">
        			<div class="control-group">
	        			<div class="controls">
		        			<select id="daerah" name="daerah" class="input-xlarge">
			                    <option value="0" >-- Pilih Daerah --</option>
			                    <option th:each="f:${listprov}" th:value="${f.id_prov}" th:text="${f.acronym}"></option>
			                </select>
			                <select id="role" name="idrole" class="input-xlarge">
			                    <option value="0" >-- Pilih Role --</option>
			                </select>
			                <select id="periode" name="idmonper" class="input-xlarge">
			                    <option value="0" >-- Pilih Tahun --</option>
			                </select>
			                <select id="group" name="group" class="form-control">
                                <option value="1" selected='true' >SDGs Goals</option>
                                <option value="2" >Role</option>
                            </select>
                            <button class="btn btn-primary" type="button" id="show_report" style="margin-top: -10px;">
                                <i class="icon-search"></i>
                            </button>
	        			</div>
	        		</div>
        		</div>
        		<div class="row-fluid">
        			<div class="control-group">
	        			<div class="controls">
	        				
			                <!-- <select id="goals" name="goals" class="input-xlarge" multiple="multiple">
			                    <option value="0" >-- All --</option>
			                    <option id="optgoals" th:each="f:${listgoals}" th:value="${f.id}" th:text="${f.nm_goals}"></option>
			                </select> -->
	        			</div>
	        		</div>
	        		<div class="control-group">
					    <div class="controls">
							<div class="accordion" id="accordion2">
								<div class="accordion-group">
								    <div class="accordion-heading">
								      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
								        <label class="lang_eng control-label" style="display:none">Choose SDGs Goals/Target</label>
					    				<label class="lang_indo control-label">Pilih Goals/Target SDG</label>
								      </a>
								    </div>
								    <div id="collapseOne" class="accordion-body collapse">
								      <div class="accordion-inner">
								      </div>
								    </div>
								  </div>
							</div>
					    	<!-- <select name="sdg_indicator" id="sdg_indicator" class=" input-block-level"  multiple="multiple" style="width:100%">
					    		<option value="0">--select--</option>
		        				<option th:each="f:${sdgIndicator}" th:value="${f.id_goals}+'---'+${f.id_target}+'---'+${f.id_indicator}" th:text="${f.nm_indicator}"></option>
		        			</select> -->
						    <span class="help-block" id="error_unit"></span>
					    </div>
					  </div>
        		</div>
        		
        	</form>
                
               <!--  <select id="target" name="target" class="form-control">
                    <option value="0" >-- Pilih Target --</option>
                </select>
                <select id="indikator" name="indikator" class="form-control">
                    <option value="0" >-- Pilih Indikator --</option>
                </select> -->
           <!--<button id="export" class="btn btn-warning pull-right">Excel</button><br/>-->
           <a class="btn btn-warning pull-right" href="#" onclick="tableToExcel('best_prac', 'Report Best Practice')">Excel</a><br/>
            
           <div class="widget-box">
                <div class="widget-title">
                    <span class="icon"><i class="icon-tasks"></i></span>
                    <h5 class="lang_indo">Laporan Praktik Terbaik</h5>
                    <h5 class="lang_eng" style="display:none">Best Practice Report</h5>
                </div>
                <div class="widget-content" id="best_prac" style="overflow-y: scroll;overflow-x: scroll;">
                    <div class="table-responsive">
                        <b>Summary</b><br/>
                        <span id="total_summary">Total : 0</span>
                    	<div id="indi_sum">
	                	<!-- <div id="divgoals" style="width:100%"></div>
	                	<div id="divtarget" style="width:100%"></div>
                    	<table id="tabatas" class='table table-striped table-bordered'></table><br><br> -->
                    	</div>
                        <hr/>
                        <b>Detail</b><br/>
                        <span id="total_detail">Total : 0</span>
                    	<div id="indi">
	                	<!-- <div id="divgoals" style="width:100%"></div>
	                	<div id="divtarget" style="width:100%"></div>
                    	<table id="tabatas" class='table table-striped table-bordered'></table><br><br> -->
                    	</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="myModalgambar"data-backdrop="static" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h3 class="lang_eng" style="display:none">Best Pactice Image</h3>
            <h3 class="lang_indo">Praktik Terbaik Gambar</h3>
        </div>
        <div class="modal-body">
            <div class="profile_img">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn tutup" data-dismiss="modal" aria-hidden="true">
                <span class="lang_eng" style="display:none">Close</span>
                <span class="lang_indo">Tutup</span>
            </button>
        </div>
    </div>
    
</div>
<div class="modal-loading-new"></div>
<style th:inline="text">
			.modal-loading-new {
				opacity: 0.4!important;
				display:    none;
				position:   fixed;
				z-index:    1000;
				top:        0;
				left:       0;
				height:     100%;
				width:      100%;
				background: #333 url([[@{/img/loading.gif}]]) 50% 50% no-repeat;
			}
			/* When the body has the loading class, we turn the scrollbar off with overflow:hidden */
			body.loading {
				overflow: hidden;   
			}
			body.loading .modal-loading-new {
				display: block;
			}
			.select2-results__option{
			    position: relative;
			    margin-left: 10px;
			    list-style: none;
			}
			
			.dotOk {
			  height: 25px;
			  width: 25px;
			  background-color: green;
			  border-radius: 50%;
			  display: inline-block;
			}
			.dotNok {
			  height: 25px;
			  width: 25px;
			  background-color: red;
			  border-radius: 50%;
			  display: inline-block;
			}
		</style>
<div th:include="admin/layout :: footer"></div>
<script th:inline="javascript">
	//$('#goals').select2();
	$("#goals").select2({
        width: "30%",
      });
	
	$("#goals").on("change", function(){
		var val = $(this).val();
		if(val){
			if(val[0]==0){	
				$("#goals").val(null).trigger("change");
			}
		}		 
	});
    var lang = [[${lang}]];
    if (lang == null) lang = "0";
    var name = [[${name}]];
    var role = [[${role}]];
    $("#welcome").html("Welcome, "+name);

    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
	//Bahasa
    var titleDel = "Anda Yakin";
    var messDel = "Menghapus Data?";
    var buttDel = 'Ya, Hapus data ini!';
    var titleOk	= "Hapus";
    var messOk = "Data berhasil dihapus";
    var messNOk = "Data tidak dapat dihapus";
    var required = "Harus diisi";
    function bhs(cek){
		if(cek){
			$(".lang_indo").show();
    		$(".lang_eng").hide();
    		titleDel = "Anda Yakin";
    		messDel = "Menghapus Data?";
    		buttDel = 'Ya, Hapus data ini!';
    		titleOk	= "Hapus";
	        messOk = "Data berhasil dihapus";
	        messNOk = "Data tidak dapat dihapus";
	        required = "Harus diisi";
    	}else{	    	        
	        $(".lang_indo").hide();
    		$(".lang_eng").show();
    		titleDel = "Are you sure";
    		messDel = "Delete this data?";
    		buttDel = 'Yes, Delete this data!';
    		titleOk	= "Delete";
	        messOk = "Delete successful";
	        messNOk = "Can't delete data";
	        required = "Required";
    	}
    }
    if(lang){
    	bhs(lang=="0");
    }else{
    	bhs($('#fs').is(':checked'));
    }
    $('#fs').on('change', function(e){
    	bhs($(this).is(':checked'));
    	$("#role").trigger("change");
    });
    
    // ********************** Fungsi pilih select option Provinsi **********************
    $("#daerah").on("change", function(){
        var valdaerah = $(this).val();
        if (valdaerah != "0") {
            $.ajax({
                url: urls + "getrolebyidprov",
                type: 'get',
                data: 'id_prov='+valdaerah,
                dataType: 'json',
                cache: false,
                success: function(result) {
                    $("#role").empty();
                    $("#role").append("<option value='0'>-- Pilih Role --</option>");
                    $("#role").append("<option value='131313'>-- All --</option>");
                    /* $("#role").append("<option data-cat='all' value='all'>-- ALL --</option>"); */
                    for (var i=0; i<result.length; i++) {
                        $("#role").append("<option data-cat='"+result[i]['cat_role']+"' value='" + result[i]['id_role'] + "'>" + result[i]['nm_role'] + "</option>");
                    }
                }
            });
            $.ajax({
                type: "GET",
                url: urls+'list-get-option-monper-report/'+valdaerah,
                success: function (result1) {
                	$("#periode").empty();
                    $("#periode").html('<option value="0" >-- Pilih Tahun --</option>');
//                    $("#periode").append('<option value="999999###111111" >-- All --</option>');
                    var array1 = result1.content;
                    if (array1 != '') {
                        for (i in array1) {
                            var selisih     = (array1[i][2] - array1[i][1]);
                            var x;
                            for(x=0; x<=selisih; x++){
                                $("#periode").append('<option value="'+array1[i][0]+'###'+(array1[i][1]+x)+'" >'+(array1[i][1]+x)+'</option>');
                            }
                            
                        }
                    }
                }
            });
        }
    });

    // ********************** Fungsi pilih select option Role **********************
    var status;
    function callback(response) {
        status = response;
    }
    
    $("#periode").on("change", function(){
    	/* SDG INDICATOR */
        //Indikator SDG untuk mapping
        		$("#indi").html("");
    	        var monper = $("#periode").val().split("###");
    	    	var id_monper   = monper[0];
    	    	var year   = monper[1];
    	        var cekbok = "";
    	        $.ajax({
    	            url: urls + "get-sdg-goals-best",
    	            data: {'id_monper':id_monper},
    	            type: 'get',
    	            dataType: 'json',
    	            async : false,
    	            success: function (response) {
    	        		$('.accordion-inner').html(cekbok);
    	        		cekbok += '<label style="display:inline-block;white-space:nowrap;">'+
    	        				'<input class="menu-master sdg-indikator" name="sdg_indicator_all" id="all-sdg" type="checkbox" style="vertical-align:middle" value="0">&nbsp;&nbsp;&nbsp;'+
    	                        '<span style="vertical-align:middle">ALL</span>'+
    	                  '</label><br/>';
    	            	for (var i = 0; i < response.sdg.length; i++) {
    	        			var nm_goals;
    	        			var id_goals=response.sdg[i][0];
    	        			var kode_goals=response.sdg[i][3];
    	                	if($("#fs").is(':checked')){
    	                		nm_goals = response.sdg[i][1];
    						}else{
    							nm_goals = response.sdg[i][2];
    						}
    	                	cekbok += '<label for="menu'+id_goals +'" style="display:inline-block;white-space:nowrap;">'+
    	                				'<input class="menu-master sdg-indikator" id="menu'+id_goals+'" name="sdg_indicator" data-id="'+id_goals+'" type="checkbox" style="vertical-align:middle" value="'+id_goals+'---0---0">&nbsp;&nbsp;&nbsp;'+
    		                            '<span style="vertical-align:middle">'+kode_goals+" "+nm_goals+'</span>'+
    		                      '</label><br/>';
    	                  $.ajax({
    	                      url: urls + 'get-sdg-target-best',
    	                      type: 'get',
    	                      data: {'id_goals':id_goals,'id_monper':id_monper},
    	                      dataType: 'json',
    	                      cache: false,
    	                      async : false,
    	                      success: function (result) {
    	                      	for (var j = 0; j < result.content.length; j++) {
    	                      		var nm_target;
    	                      		var id_target=result.content[j][0];
    	                      		var kode_target=result.content[j][3];
    	                          	if($("#fs").is(':checked')){
    	                          		nm_target = result.content[j][1];
    	      						}else{
    	      							nm_target = result.content[j][2];
    	      						}
    	                          	cekbok += '<label for="submenu'+id_target+'" style="display:inline-block;white-space:nowrap;margin-left:20px">'+
    	            					'<input data-goals="'+id_goals+'" data-id="'+id_target+'" class="sdg-indikator menu'+id_goals+' menu-slave" id="submenu'+id_target+'" type="checkbox" name="sdg_indicator" style="vertical-align:middle"  value="'+id_goals+'---'+id_target+'---0">&nbsp;&nbsp;&nbsp;'+
    		                            '<span style="vertical-align:middle">'+kode_goals+"."+kode_target+" "+nm_target+'</span>'+
    		                      '</label><br/>';
    		                      
    	                          	$.ajax({
    	      	                      url: urls + 'get-sdg-indicator-best',
    	      	                      type: 'get',
    	      	                      data: {'id_target':id_target,'id_monper':id_monper},
    	      	                      dataType: 'json',
    	      	                      cache: false,
    	      	                      async : false,
    	      	                      success: function (result1) {
    	      	                      	for (var k = 0; k < result1.content.length; k++) {
    	      	                      		var nm_indicator;
    	      	                      		var id_indicator=result1.content[k][0];
    	      	                      		var kode_indicator=result1.content[k][3];
    	      	                          	if($("#fs").is(':checked')){
    	      	                          		nm_indicator = result1.content[k][1];
    	      	      						}else{
    	      	      							nm_indicator = result1.content[k][2];
    	      	      						}
    	      	                          	cekbok += '<label for="submenu'+id_indicator+'" style="display:inline-block;white-space:nowrap;margin-left:40px">'+
    	      	            					'<input data-goals="'+id_goals+'" data-id="'+id_indicator+'" class="sdg-indikator menu'+id_goals+' menu-slave" id="submenu'+id_target+'" type="checkbox" name="sdg_indicator" style="vertical-align:middle"  value="'+id_goals+'---'+id_target+'---'+id_indicator+'">&nbsp;&nbsp;&nbsp;'+
    	      		                            '<span style="vertical-align:middle">'+kode_goals+"."+kode_target+"."+kode_indicator+" "+nm_indicator+'</span>'+
    	      		                      '</label><br/>';
    	      		                      
    	      	                      	}
    	      	                      }
    	      	                  });
    	                      	}
    	                      }
    	                  });
    	            	}
    	            }
    	        });
    	        cekbok += "<hr/><button type='button' id='filter-sdg' class='btn btn-success'>Apply</button>";
    			$('.accordion-inner').append(cekbok);
    	    	$('.accordion-inner').find('#all-sdg').prop( "checked", true ).trigger("change");
    	    	
    	    	$('.accordion-inner').on('change', '#all-sdg', function(){
    	        	var status = this.checked;
    	        	$('.accordion-inner').find("input[name='sdg_indicator']").each(function(){
    	        		this.checked = status;
    	        	});
    	        });
    	        
    	        $('.accordion-inner').on('click', '.menu-master', function(){
    	        	var id = $(this).data('id');
    	        	if ($(this).is(":checked")) {
    	                $(".accordion-inner").find('.menu'+id).prop("checked", true);
    	            } else {
    	            	 $(".accordion-inner").find('.menu'+id).prop("checked", false);
    	            	 $('.accordion-inner').find('#all-sdg').prop( "checked", false );
    	            }
    	        });
    	        
    	        $('.accordion-inner').on('click', '.menu-slave', function(){
    	        	var id = $(this).data('id');
    	        	var goals = $(this).data('goals');
    	        	if ($(this).is(":checked")) {
    	                $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
    	            } else {
    	            	 $(".accordion-inner").find('.menu-slave'+id).prop("checked", false);
    	            	 $('.accordion-inner').find('#all-sdg').prop( "checked", false );
    	            }
    	        	
    	        	if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
    	                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
    	            } else {
    	            	 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
    	            	 $('.accordion-inner').find('#all-sdg').prop( "checked", false );
    	            }
    	        });
    	        
    	        $('.accordion-inner').on('click', '.menu-slave-1', function(){
    	        	var id = $(this).data('id');
    	        	var goals = $(this).data('goals');
    	        	if ($(".menu-slave-1-"+id+":checked").length==$(".menu-slave-1-"+id).length) {
    	                $(".accordion-inner").find('#submenu'+id).prop("checked", false);
    	            } else {
    	            	 $(".accordion-inner").find('#submenu'+id).prop("checked", false);
    	            	 $('.accordion-inner').find('#all-sdg').prop( "checked", false );
    	            }
    	        	
    	        	if ($(".menu"+goals+":checked").length==$(".menu"+goals).length) {
    	                $(".accordion-inner").find('#menu'+goals).prop("checked", false);
    	            } else {
    	            	 $(".accordion-inner").find('#menu'+goals).prop("checked", false);
    	            	 $('.accordion-inner').find('#all-sdg').prop( "checked", false );
    	            }
    	        });

    });
    
    $('#show_report').on('click', function(){
    	$("#indi").html("");
    	if($('#group').val() == "1"){
    		ambilData(0);	
    	}else{
    		ambilDataIns(0);
    	}
        	
        ambilData_sum(0);
    });
    
    $("#role").on("change", function(){
        var idrole = $(this).val();
        if (idrole != "0") {
            $("#indi").html("");
        }
        //ambilData(0);	
        //ambilData_sum(0);
    });
    
    $('.accordion-inner').on('click', '#filter-sdg', function(){
    	var sdg_indicator;
        var sdg_indicator_val = [];
        $.each($("input[name='sdg_indicator']:checked"), function(){
            sdg_indicator_val.push($(this).val());
        });
        if($('.accordion-inner').find("input[name='sdg_indicator_all']").is(':checked')){
        	sdg_indicator = '0';
        	console.log(sdg_indicator);
        }else if(sdg_indicator_val.length>0){
            sdg_indicator = sdg_indicator_val.toString();
        }else{
            sdg_indicator = '0';
        }
        
        if($('#group').val() == "1"){
        	 ambilData(sdg_indicator);
    	}else{
    		ambilDataIns(sdg_indicator);
    	}
       	
        ambilData_sum(sdg_indicator);	
    });
    
    function ambilData(sdg_indicator){
    	var monper = $("#periode").val().split("###");
    	var id_monper   = monper[0];
    	var year   = monper[1];
        var idrole = $("#role").val();
        var idprov = $("#daerah").val();
        var cat = $("#role").find(":selected").data("cat");
        var jml = 0;
        $("#indi").html("");
        var text="";
        $.ajax({
            url: urls + "getentryshowreport_best",
            type: 'get',
            data: { "id_monper":id_monper, "year":year},
            dataType: 'json',
            async:false,
            success: function (result) {
            	var array_level1 = result.content;
                if (array_level1 != '') {
                    for (i in array_level1) {
                        //level1
                        if($('#fs').is(':checked')){
                            var prog_l_1 = "Tahun : "+array_level1[i][2];
                        }else{
                            var prog_l_1 = "Year : "+array_level1[i][2];
                        }
                        text += "<div >"+prog_l_1+"</div>";
                        
                        
                        $.ajax({
                            url: urls + "getbest_level2/"+sdg_indicator,
                            type: 'get',
                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":idrole, "id_prov":idprov},
                            dataType: 'json',
                            async:false,
                            success: function (result2) {
                                var array_level2 = result2.content;
                                if (array_level2 != '') {
                                    for (o in array_level2) {
                                        //level2
                                        
//                                        if(array_level3[p][15] == null || array_level3[p][15] == '0'){
//                                            var no_target = '';
//                                        }else{
//                                            var no_target = array_level3[p][15];
//                                        }
                                        if($('#fs').is(':checked')){
                                            var prog_l = "Capaian : "+(array_level2[o][1]?array_level2[o][1]:'')+" "+(array_level2[o][2]?array_level2[o][2]:'Tidak termapping');
                                        }else{
                                            var prog_l = "Goals : "+(array_level2[o][1]?array_level2[o][1]:'')+" "+(array_level2[o][3]?array_level2[o][3]:'Unmapped');
                                        }
                                        text += "<div >"+prog_l+"</div>";
                                        
                                        if($('#fs').is(':checked')){
                                            var head1       = "Indikator";
                                            var head2       = "Institusi";
                                            var head3       = "Lokasi dan Waktu Aktivitas";
                                            var head4       = "Latar Belakang";
                                            var head5       = "Proses Implementasi";
                                            var head6       = "Tantangan dan Pembelajaran";
                                        }else{
                                            var head1       = "Indicator";
                                            var head2       = "Institution";
                                            var head3       = "Location and Time of Activity";
                                            var head4       = "Background";
                                            var head5       = "Implementation Process";
                                            var head6       = "Challenge and Learning";
                                        }

                                        text += "<table class='table table-striped table-bordered tabel-sdg' id='tbbest' width='100%'><thead>";
                                        text += "<tr style='font-size:80%;'>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b><span>"+head1+"</span></b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head2+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>Program</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head3+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head4+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head5+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head6+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b><span class='disaggre_hide'>Action</span></b></th>";
                                        text += "</tr></thead>";
                                        $.ajax({
                                            url: urls + "getbest_level3/"+sdg_indicator,
                                            type: 'get',
                                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":idrole, "id_prov":idprov, "id_goals":array_level2[o][0]},
                                            dataType: 'json',
                                            async:false,
                                            success: function (result3) {
                                                var array_level3 = result3.content;
                                                jml += parseInt(result3.content.length);
                                                
                                                if (array_level3 != '') {
                                                    for (p in array_level3) {
                                                        if(array_level3[p][15] == null || array_level3[p][15] == '0'){
                                                            var no_target = '';
                                                        }else{
                                                            var no_target = array_level3[p][15];
                                                        }
                                                        if(array_level3[p][16] == null || array_level3[p][16] == '0'){
                                                            var isi_target = '';
                                                        }else{
                                                            var isi_target = array_level3[p][16];
                                                        }
                                                        if(array_level3[p][17] == null || array_level3[p][17] == '0'){
                                                            var isi_target1 = '';
                                                        }else{
                                                            var isi_target1 = array_level3[p][17];
                                                        }
                                                        if(array_level3[p][18] == null || array_level3[p][18] == '0'){
                                                            var no_indicator = '';
                                                        }else{
                                                            var no_indicator = array_level3[p][18];
                                                        }
                                                        if(array_level3[p][19] == null || array_level3[p][19] == '0'){
                                                            var isi_indicator = '';
                                                        }else{
                                                            var isi_indicator = array_level3[p][19];
                                                        }
                                                        if(array_level3[p][20] == null || array_level3[p][20] == '0'){
                                                            var isi_indicator1 = '';
                                                        }else{
                                                            var isi_indicator1 = array_level3[p][20];
                                                        }
                                                        //level2
                                                        if($('#fs').is(':checked')){
                                                            var target      = array_level2[o][1]+"."+no_target+" "+isi_target;
                                                            var indicator   = array_level2[o][1]+"."+no_target+"."+no_indicator+" "+isi_indicator;
                                                        }else{
                                                            var target      = array_level2[o][1]+"."+no_target+" "+isi_target1;
                                                            var indicator   = array_level2[o][1]+"."+no_target+"."+no_indicator+" "+isi_indicator1;
                                                        }
                                                        
                                                        text += "<tr style='font-size:80%;border-style:ridge;'>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+(no_target?target:'')+"<br/>"+(no_indicator?indicator:'')+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][14]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][8]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][9]+" "+array_level3[p][10]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][11]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][12]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][13]+"</td>";
                                                        var view = '<button data-id="'+array_level3[p][21]+'" type="button" title="view" class="btn btn-warning btn-mini view"><span class="lang_eng disaggre_hide" style="display:none">View Image</span><span class="lang_indo disaggre_hide">Lihat Gambar</span></button>';
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+view+"</td>";
                                                        text += "</tr>";
                                                        

                                                    }
                                                }
                                            }
                                        });
                                        text += "</tbody></table>";
                                    }
                                }
                            }
                        });
                        
                    }
                }
                $("#total_detail").html("Total : "+jml)
            }
        });
        $("#indi").html(text);
    }
    
    function ambilDataIns(sdg_indicator){
    	var monper = $("#periode").val().split("###");
    	var id_monper   = monper[0];
    	var year   = monper[1];
        var idrole = $("#role").val();
        var idprov = $("#daerah").val();
        var cat = $("#role").find(":selected").data("cat");
        var jml = 0;
        $("#indi").html("");
        var text="";
        $.ajax({
            url: urls + "getentryshowreport_best",
            type: 'get',
            data: { "id_monper":id_monper, "year":year},
            dataType: 'json',
            async:false,
            success: function (result) {
            	var array_level1 = result.content;
                if (array_level1 != '') {
                    for (i in array_level1) {
                        //level1
                        if($('#fs').is(':checked')){
                            var prog_l_1 = "Tahun : "+array_level1[i][2];
                        }else{
                            var prog_l_1 = "Year : "+array_level1[i][2];
                        }
                        text += "<div >"+prog_l_1+"</div>";
                        
                        
                        $.ajax({
                            url: urls + "getbest_level2_ins/"+sdg_indicator,
                            type: 'get',
                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":idrole, "id_prov":idprov},
                            dataType: 'json',
                            async:false,
                            success: function (result2) {
                                var array_level2 = result2.content;
                                if (array_level2 != '') {
                                    for (o in array_level2) {
                                        //level2
                                        text += "<div >"+array_level2[o][1]+"</div>";
                                        
                                        if($('#fs').is(':checked')){
                                            var head1       = "Indikator";
                                            var head2       = "Institusi";
                                            var head3       = "Lokasi dan Waktu Aktivitas";
                                            var head4       = "Latar Belakang";
                                            var head5       = "Proses Implementasi";
                                            var head6       = "Tantangan dan Pembelajaran";
                                        }else{
                                            var head1       = "Indicator";
                                            var head2       = "Institution";
                                            var head3       = "Location and Time of Activity";
                                            var head4       = "Background";
                                            var head5       = "Implementation Process";
                                            var head6       = "Challenge and Learning";
                                        }

                                        text += "<table class='table table-striped table-bordered tabel-sdg' id='tbbest' width='100%'><thead>";
                                        text += "<tr style='font-size:80%;'>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b><span>"+head1+"</span></b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head2+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>Program</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head3+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head4+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head5+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head6+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b><span class='disaggre_hide'>Action</span></b></th>";
                                        text += "</tr></thead>";
                                        $.ajax({
                                            url: urls + "getbest_level3_ins/"+sdg_indicator,
                                            type: 'get',
                                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":array_level2[o][0], "id_prov":idprov},
                                            dataType: 'json',
                                            async:false,
                                            success: function (result3) {
                                                var array_level3 = result3.content;
                                                jml += parseInt(result3.content.length);
                                                
                                                if (array_level3 != '') {
                                                    for (p in array_level3) {
                                                        if(array_level3[p][15] == null || array_level3[p][15] == '0'){
                                                            var no_target = '';
                                                        }else{
                                                            var no_target = array_level3[p][15];
                                                        }
                                                        if(array_level3[p][16] == null || array_level3[p][16] == '0'){
                                                            var isi_target = '';
                                                        }else{
                                                            var isi_target = array_level3[p][16];
                                                        }
                                                        if(array_level3[p][17] == null || array_level3[p][17] == '0'){
                                                            var isi_target1 = '';
                                                        }else{
                                                            var isi_target1 = array_level3[p][17];
                                                        }
                                                        if(array_level3[p][18] == null || array_level3[p][18] == '0'){
                                                            var no_indicator = '';
                                                        }else{
                                                            var no_indicator = array_level3[p][18];
                                                        }
                                                        if(array_level3[p][19] == null || array_level3[p][19] == '0'){
                                                            var isi_indicator = '';
                                                        }else{
                                                            var isi_indicator = array_level3[p][19];
                                                        }
                                                        if(array_level3[p][20] == null || array_level3[p][20] == '0'){
                                                            var isi_indicator1 = '';
                                                        }else{
                                                            var isi_indicator1 = array_level3[p][20];
                                                        }
                                                        if(array_level3[p][22] == null || array_level3[p][22] == '0'){
                                                            var no_goal = '';
                                                        }else{
                                                            var no_goal = array_level3[p][22];
                                                        }
                                                        if(array_level3[p][23] == null || array_level3[p][23] == '0'){
                                                            var isi_goal = '';
                                                        }else{
                                                            var isi_goal = array_level3[p][23];
                                                        }
                                                        if(array_level3[p][24] == null || array_level3[p][24] == '0'){
                                                            var isi_goal1 = '';
                                                        }else{
                                                            var isi_goal1 = array_level3[p][24];
                                                        }
                                                        //level2
                                                        if($('#fs').is(':checked')){
                                                            var target      = no_goal+"."+no_target+" "+isi_target;
                                                            var indicator   = no_goal+"."+no_target+"."+no_indicator+" "+isi_indicator;
                                                            var goal        = no_goal+" "+isi_goal;
                                                        }else{
                                                            var target      = no_goal+"."+no_target+" "+isi_target1;
                                                            var indicator   = no_goal+"."+no_target+"."+no_indicator+" "+isi_indicator1;
                                                            var goal        = no_goal+" "+isi_goal1;
                                                        }
                                                        
                                                        text += "<tr style='font-size:80%;border-style:ridge;'>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+goal+"<br/>"+(no_target?target:'')+"<br/>"+(no_indicator?indicator:'')+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][14]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][8]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][9]+" "+array_level3[p][10]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][11]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][12]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][13]+"</td>";
                                                        var view = '<button data-id="'+array_level3[p][21]+'" type="button" title="view" class="btn btn-warning btn-mini view"><span class="lang_eng disaggre_hide" style="display:none">View Image</span><span class="lang_indo disaggre_hide">Lihat Gambar</span></button>';
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+view+"</td>";
                                                        text += "</tr>";
                                                        

                                                    }
                                                }
                                            }
                                        });
                                        text += "</tbody></table>";
                                    }
                                }
                            }
                        });
                        
                    }
                }
                $("#total_detail").html("Total : "+jml)
            }
        });
        $("#indi").html(text);
    }
    
    function ambilData_sum(sdg_indicator){
    	var monper = $("#periode").val().split("###");
    	var id_monper   = monper[0];
    	var year   = monper[1];
        var idrole = $("#role").val();
        var idprov = $("#daerah").val();
        var cat = $("#role").find(":selected").data("cat");
        var jml = 0;
        $("#indi_sum").html("");
        var text="";
        $.ajax({
            url: urls + "getentryshowreport_best",
            type: 'get',
            data: { "id_monper":id_monper, "year":year},
            dataType: 'json',
            async:false,
            success: function (result) {
            	var array_level1 = result.content;
                if (array_level1 != '') {
                    for (i in array_level1) {
                        //level1
                        if($('#fs').is(':checked')){
                            var prog_l_1 = "Tahun : "+array_level1[i][2];
                        }else{
                            var prog_l_1 = "Year : "+array_level1[i][2];
                        }
                        text += "<div >"+prog_l_1+"</div>";
                        
                        
                        $.ajax({
                            url: urls + "getbest_level2_sum/"+sdg_indicator,
                            type: 'get',
                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":idrole, "id_prov":idprov},
                            dataType: 'json',
                            async:false,
                            success: function (result2) {
                                var array_level2 = result2.content;
                                if (array_level2 != '') {
                                    for (o in array_level2) {
                                        //level2
                                        if($('#fs').is(':checked')){
                                            var prog_l = "Capaian : "+array_level2[o][1]+" "+array_level2[o][2];
                                        }else{
                                            var prog_l = "Goals : "+array_level2[o][1]+" "+array_level2[o][3];
                                        }
                                        text += "<div >"+prog_l+"</div>";
                                        
                                        if($('#fs').is(':checked')){
                                            var head1       = "Indikator";
                                            var head2       = "Institusi";
                                            var head3       = "Lokasi dan Waktu Aktivitas";
                                            var head4       = "Latar Belakang";
                                            var head5       = "Proses Implementasi";
                                            var head6       = "Tantangan dan Pembelajaran";
                                        }else{
                                            var head1       = "Indicator";
                                            var head2       = "Institution";
                                            var head3       = "Location and Time of Activity";
                                            var head4       = "Background";
                                            var head5       = "Implementation Process";
                                            var head6       = "Challenge and Learning";
                                        }

                                        text += "<table class='table table-striped table-bordered tabel-sdg' width='100%' style='border-style:ridge;'><thead>";
                                        text += "<tr style='font-size:80%;border-style:ridge;'>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head1+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head2+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>Program</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head3+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head4+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head5+"</b></th>";
                                        text += "<th style='text-align:center;vertical-align:middle;border-style:ridge;'><b>"+head6+"</b></th>";
                                        text += "</tr></thead>";
                                        $.ajax({
                                            url: urls + "getbest_level3_sum/"+sdg_indicator,
                                            type: 'get',
                                            data: { "id_monper":array_level1[i][1], "year":array_level1[i][2], "id_role":idrole, "id_prov":idprov, "id_goals":array_level2[o][0]},
                                            dataType: 'json',
                                            async:false,
                                            success: function (result3) {
                                                var array_level3 = result3.content;
                                                jml += parseInt(result3.content.length);
                                                
                                                if (array_level3 != '') {
                                                    for (p in array_level3) {
                                                        //level2
                                                        if($('#fs').is(':checked')){
                                                            var target      = array_level2[o][1]+"."+array_level3[p][15]+" "+array_level3[p][16];
                                                            var indicator   = array_level2[o][1]+"."+array_level3[p][15]+"."+array_level3[p][18]+" "+array_level3[p][19];
                                                        }else{
                                                            var target      = array_level2[o][1]+"."+array_level3[p][15]+" "+array_level3[p][17];
                                                            var indicator   = array_level2[o][1]+"."+array_level3[p][15]+"."+array_level3[p][18]+" "+array_level3[p][20];
                                                        }
                                                        
                                                        text += "<tr style='font-size:80%;border-style:ridge;'>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+(array_level3[p][15]?target:'')+"<br/>"+(array_level3[p][18]?indicator:'')+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'></td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][8]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][9]+" "+array_level3[p][10]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][11]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][12]+"</td>";
                                                        text += "<td style='font-size:80%;border-style:ridge;'>"+array_level3[p][13]+"</td>";
                                                        text += "</tr>";
                                                        

                                                    }
                                                }
                                            }
                                        });
                                        text += "</tbody></table>";
                                    }
                                }
                            }
                        });
                        
                    }
                }
                $("#total_summary").html("Total : "+jml)
            }
        });
        $("#indi_sum").html(text);
    }
    
    
    $("#export").on("click", function(){
        var sdg_indicator;
        var sdg_indicator_val = [];
        $.each($("input[name='sdg_indicator']:checked"), function(){
            sdg_indicator_val.push($(this).val());
        });
        if(sdg_indicator_val.length>0){
            sdg_indicator = sdg_indicator_val.toString();
        }else{
            sdg_indicator = '0';
        }
        
        var monper      = $("#periode").val().split("###");
    	var id_monper   = monper[0];
    	var year        = monper[1];
        var idrole      = $("#role").val();
        var idprov      = $("#daerah").val();
        if($('#fs').is(':checked')){
            var subtitle = "indo";
        }else{
            var subtitle = "eng";
        }
        
        $cek = 0;
        if (idrole == '0'){	
            if($('#fs').is(':checked')){
                swal("Anda harus memilih Role");
            }else{
                swal("You must Choose Role");
            }
            $cek += 1;
        }
        if (monper == '0'){					
            if($('#fs').is(':checked')){
                swal("Anda harus memilih Periode");
            }else{
                swal("You must Choose Period");
            }
            $cek += 1;
        }
        if (idprov == '0'){					
            if($('#fs').is(':checked')){
                swal("Anda harus memilih Provinsi");
            }else{
                swal("You must Choose Province");
            }
            $cek += 1;
        }
        if (sdg_indicator == '0'){					
            if($('#fs').is(':checked')){
                swal("Anda harus memilih Goal/target");
            }else{
                swal("You must Choose Goal/target");
            }
            $cek += 1;
        }
        if ($cek == 0){
            window.open(urls+"best/download_report-best/"+idprov+"/"+idrole+"/"+id_monper+"/"+year+"/"+sdg_indicator+"/"+subtitle , "_blank");
        }

    });
    
    $('#best_prac').on('click', '.view', function(){
        var id = $(this).attr('data-id');
        $("#myModalgambar").modal("show");
        $.ajax({
            type: "GET",
            url: urls+'get-all-foto/'+id,
            success: function (resulthasil) {
                var val2 = resulthasil.content;
                var ht = "";
                for(var i=0;i<val2.length;i++){
                    ht += '<img class="img-responsive avatar-view" id="gambar-profil" src="data:image/jpg;base64,'+val2[i][2]+'" alt="Picture" style="width: 200px"/><br/><br/>';
                }
                $(".profile_img").html(ht);
            }
        });
     });
    
    var tableToExcel = (function() {
     var uri = 'data:application/vnd.ms-excel;base64,'
     , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
     , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
     , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
     return function(table, name) {
     $('#best_prac').find('.disaggre_hide').hide();
     if (!table.nodeType) table = document.getElementById(table)
     var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
     window.location.href = uri + base64(format(template, ctx))
     $('#best_prac').find('.disaggre_hide').show();
     }
     })()
    
//    var tableToExcel = (function() {
//    var uri = 'data:application/vnd.ms-excel;base64,'
//    , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
//    , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
//    , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
//    return function(table, name) {
//    if (!table.nodeType) table = document.getElementById(table)
//    var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
//    window.location.href = uri + base64(format(template, ctx))
//    }
//    })()
    
    
</script>
</body>
</html>